<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>MyBatis 初级篇 | ahao</title><meta name="author" content="ahao"><meta name="copyright" content="ahao"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="MyBatis 实验环境搭建前言MyBatis 是一个理论少，实践性强的框架；它没有太多的概念，最好的学习方式就是实践。本小节，我们将一起搭建 MyBatis 的实践环境，方便后续章节的学习。 新建项目考虑到工程的维护性，我们选择 IDE 来新建一个 Maven 项目来使用 MyBatis。当然如果你更倾向了 Gradle，那么没有关系，你只需要更改添加依赖的方式即可。 在 IDE 上，你可以选择">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis 初级篇">
<meta property="og:url" content="https://ahao.ink/posts/MyBatis%20%E5%88%9D%E7%BA%A7%E7%AF%87/index.html">
<meta property="og:site_name" content="ahao">
<meta property="og:description" content="MyBatis 实验环境搭建前言MyBatis 是一个理论少，实践性强的框架；它没有太多的概念，最好的学习方式就是实践。本小节，我们将一起搭建 MyBatis 的实践环境，方便后续章节的学习。 新建项目考虑到工程的维护性，我们选择 IDE 来新建一个 Maven 项目来使用 MyBatis。当然如果你更倾向了 Gradle，那么没有关系，你只需要更改添加依赖的方式即可。 在 IDE 上，你可以选择">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2021/12/26/LKQbkw4Bgr3ZjfX.png">
<meta property="article:published_time" content="2021-06-16T05:36:41.000Z">
<meta property="article:modified_time" content="2021-12-26T14:32:12.561Z">
<meta property="article:author" content="ahao">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2021/12/26/LKQbkw4Bgr3ZjfX.png"><link rel="shortcut icon" href="https://i.loli.net/2021/11/12/NAU53jI9mGOJlDC.png"><link rel="canonical" href="https://ahao.ink/posts/MyBatis%20%E5%88%9D%E7%BA%A7%E7%AF%87/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-12-26 22:32:12'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><link rel="stylesheet" href="APlayer.min.css"><div id="aplayer"></div><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js" async></script><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://i.loli.net/2021/11/12/Edhsr56wxfUbuFg.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 读书</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2021/12/26/LKQbkw4Bgr3ZjfX.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">ahao</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首頁</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 读书</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MyBatis 初级篇</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-06-16T05:36:41.000Z" title="发表于 2021-06-16 13:36:41">2021-06-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-12-26T14:32:12.561Z" title="更新于 2021-12-26 22:32:12">2021-12-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MyBatis/">MyBatis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">20.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>80分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MyBatis 初级篇"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="MyBatis-实验环境搭建"><a href="#MyBatis-实验环境搭建" class="headerlink" title="MyBatis 实验环境搭建"></a>MyBatis 实验环境搭建</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>MyBatis 是一个理论少，实践性强的框架；它没有太多的概念，最好的学习方式就是<code>实践</code>。本小节，我们将一起搭建 MyBatis 的实践环境，方便后续章节的学习。</p>
<h2 id="新建项目"><a href="#新建项目" class="headerlink" title="新建项目"></a>新建项目</h2><p>考虑到工程的维护性，我们选择 IDE 来新建一个 Maven 项目来使用 MyBatis。当然如果你更倾向了 Gradle，那么没有关系，你只需要更改添加依赖的方式即可。</p>
<p>在 IDE 上，你可以选择 Eclipse 或者 IDEA，当然我们更推荐你使用 IDEA，因为它的社区版已经足够我们学习 MyBatis 了，而且它也是免费的，本小节我们以 IDEA 作为默认的开发环境。</p>
<p>打开 IDEA，选择 <code>New Project</code>，点击左侧的<code>Maven</code>项，然后 Next 新建项目，如下图：</p>
<img src="https://s2.loli.net/2021/12/25/mojPfHZIGh2OxXd.png" alt="image-20211225110403476" style="zoom:80%;" />

<p>进入下一页后，输入对应的 GroupId 和 ArtifactId，如下图，你也可以选择自己心仪的 id，但是我们推荐你跟我们<code>保持一致</code>，这样在后面的学习中，你的配置和代码才能跟我们完全一致。</p>
<img src="https://s2.loli.net/2021/12/25/mCSKhefv27XHstM.png" alt="image-20211225110326468" style="zoom:80%;" />

<p>填完以后，点击 Next 直到出现 Finish，点击完成即可。</p>
<h2 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h2><p>项目新建后，在项目根目录下找到 <code>pom.xml</code>文件，并向其中添加如下配置。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- MyBatis 依赖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- mysql 驱动 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.18<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 日志依赖 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 文件打包配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.properties<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.tld<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>false<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加的依赖比较多，虽然在相应的地方我们也打上了注释，不过我们依然得说明一下。dependency 是 Maven 管理依赖的方式，我们分别添加了 mybatis、mysql-connector-java 和 logback-classic。</p>
<p>其中 MyBatis 作为我们的主角，它的依赖是必不可少的；由于实操需要数据库环境，我们也添加上了 MySQL 驱动依赖；为了更好的查看信息，我们也添加了 logback 日志框架。</p>
<p>另外，由于 Maven 打包默认不会打包 <code>src/main/java</code>文件夹下的资源文件，但实际的环境中，我们可能需要在该文件夹下存放资源文件，如<code>.xml</code>，所以我们也必须更改这个配置。</p>
<p>添加依赖后，IDE 会提供你是否导入这些依赖，请你点击确认，并且等待一会儿，待依赖导入完成我们就可以进入下一步了。</p>
<h2 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h2><p>项目搭建好后，我们还需要一定的数据支持。首先，请在你可用的数据库环境中新建一个名为<code>mybatisdemo</code>的数据库，当然你也可以使用其它的名称，但还是希望你能与我们保持一致，新建数据库成功后，接着运行以下 SQL 脚本。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">  id <span class="type">int</span> <span class="keyword">PRIMARY</span> KEY AUTO_INCREMENT,</span><br><span class="line">	username <span class="type">varchar</span>(<span class="number">20</span>),</span><br><span class="line">  age <span class="type">int</span>,</span><br><span class="line">  score <span class="type">int</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">user</span>(id,username,age,score) <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="string">&#x27;peter&#x27;</span>, <span class="number">18</span>, <span class="number">100</span>),</span><br><span class="line">(<span class="number">2</span>,<span class="string">&#x27;pedro&#x27;</span>, <span class="number">24</span>, <span class="number">200</span>),(<span class="number">3</span>,<span class="string">&#x27;jerry&#x27;</span>, <span class="number">28</span>, <span class="number">500</span>),</span><br><span class="line">(<span class="number">4</span>,<span class="string">&#x27;mike&#x27;</span>, <span class="number">12</span>, <span class="number">300</span>),(<span class="number">5</span>,<span class="string">&#x27;tom&#x27;</span>, <span class="number">27</span>, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----+----------+-----+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> username <span class="operator">|</span> age <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+-----+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> peter    <span class="operator">|</span> <span class="number">18</span>  <span class="operator">|</span> <span class="number">100</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> pedro    <span class="operator">|</span> <span class="number">24</span>  <span class="operator">|</span> <span class="number">200</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> jerry    <span class="operator">|</span> <span class="number">28</span>  <span class="operator">|</span> <span class="number">500</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>  <span class="operator">|</span> mike     <span class="operator">|</span> <span class="number">12</span>  <span class="operator">|</span> <span class="number">300</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5</span>  <span class="operator">|</span> tom      <span class="operator">|</span> <span class="number">27</span>  <span class="operator">|</span> <span class="number">1000</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+----------+-----+-------+</span></span><br></pre></td></tr></table></figure>



<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>本小节是一个纯实操小节，我们没有介绍任何概念，而是带你一起搭建了学习 MyBatis 需要的环境和数据，后续的所有小节都将<code>直接依赖于</code>本小节。</p>
<h1 id="MyBatis-简单使用"><a href="#MyBatis-简单使用" class="headerlink" title="MyBatis 简单使用"></a>MyBatis 简单使用</h1><h2 id="前言-1"><a href="#前言-1" class="headerlink" title="前言"></a>前言</h2><p>在上面中，我们搭建了 MyBatis 实验环境。本小节，我们将一起学习如何使用 MyBatis，虽然在实际的开发中，你几乎不会按照本小节所介绍的方式去使用 MyBatis，但是这对你熟悉 MyBatis 整体结构有着重要作用，同时这也是面试的重点。</p>
<h2 id="编程式使用"><a href="#编程式使用" class="headerlink" title="编程式使用"></a>编程式使用</h2><p>MyBatis 官方文档中并未详细的介绍如何编程式使用 MyBatis，绝大多数情况下，我们都是通过 <code>配置文件</code>来拿到配置然后开启会话的。这样的方式固然很方便，但是却屏蔽了太多的细节，因此我们想从点到面，层层递进给你介绍 MyBatis 的基础用法。</p>
<p>接下来，我们一起来写一个简单的 demo 来使用一下 MyBatis。</p>
<h3 id="启动-MyBatis"><a href="#启动-MyBatis" class="headerlink" title="启动 MyBatis"></a>启动 MyBatis</h3><p>在 mybatis-primer 项目中，有一个默认的包<code>com.ahao.mybatis</code>，在该包下，我们新建一个包名为<code>pattern</code>，并在其中新建一个名为<code>StartNoXml.java</code>的类，并向该文件中填充如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.datasource.pooled.PooledDataSource;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.mapping.Environment;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.transaction.jdbc.JdbcTransactionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;SqlResolve&quot;, &quot;SqlNoDataSourceInspection&quot;, &quot;Duplicates&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartNoXml</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">    <span class="comment">// 无需xml配置的方式使用MyBatis</span></span><br><span class="line">    <span class="comment">// 准备jdbc事务类</span></span><br><span class="line">    JdbcTransactionFactory jdbcTransactionFactory = <span class="keyword">new</span> JdbcTransactionFactory();</span><br><span class="line">    <span class="comment">// 配置数据源</span></span><br><span class="line">    PooledDataSource dataSource =</span><br><span class="line">      <span class="keyword">new</span> PooledDataSource(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>,</span><br><span class="line">        <span class="string">&quot;jdbc:mysql://localhost:3306/mybatisdemo?useSSL=false&amp;characterEncoding=utf8&amp;serverTimezone = GMT&quot;</span>,</span><br><span class="line">        <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="comment">// 配置环境，向环境中指定环境id、事务和数据源</span></span><br><span class="line">    Environment environment = <span class="keyword">new</span> Environment.Builder(<span class="string">&quot;development&quot;</span>)</span><br><span class="line">      .transactionFactory(jdbcTransactionFactory)</span><br><span class="line">      .dataSource(dataSource).build();</span><br><span class="line">    <span class="comment">// 新建 MyBatis 配置类</span></span><br><span class="line">    Configuration configuration = <span class="keyword">new</span> Configuration(environment);</span><br><span class="line">    <span class="comment">// 得到 SqlSessionFactory 核心类</span></span><br><span class="line">    SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(configuration);</span><br><span class="line">    <span class="comment">// 开始一个 sql 会话</span></span><br><span class="line">    SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">    <span class="comment">// 得到 sql 连接并运行 sql 语句</span></span><br><span class="line">    PreparedStatement preStatement = session</span><br><span class="line">      .getConnection()</span><br><span class="line">      .prepareStatement(<span class="string">&quot;SELECT * FROM user WHERE id = ?&quot;</span>);</span><br><span class="line">    preStatement.setInt(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    ResultSet result = preStatement.executeQuery();</span><br><span class="line">    <span class="comment">// 验证结果</span></span><br><span class="line">    <span class="keyword">while</span> (result.next()) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;username: &quot;</span> + result.getString(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 关闭会话</span></span><br><span class="line">    session.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>即使你不熟悉 MyBatis，也没有必要被这段代码给吓到，因为在实际的开发中，你几乎没有机会去写这段代码。但是我们仍需要介绍这段代码，它可能是你面试的重点。</p>
<p>书写完毕后，请在 PooledDataSource 类构造函数中更改数据用户名、密码和 url 配置以满足你所使用的数据库环境。运行一下这段代码，如果一切顺利，在控制台中你会看到以下输出内容（只截取了部分内容）：</p>
<p><img src="https://s2.loli.net/2021/12/25/Mh7JZbSyBqPcXWx.png" alt="image-20211225112035789"></p>
<h3 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h3><p>在代码中，我们添加了一定量的注释说明了流程，接下来我们来总结一下。</p>
<p>对于 MyBatis 的基础使用可大致分为以下<code>3</code>步：</p>
<ol>
<li>得到 MyBatis 配置信息，即代码中的<code>Configuration</code>类。Configuration 负责 MyBatis 架构中的配置部分，例如：dataSource数据源信息都会交给 Configuration 去管理；这一步其实是比较繁杂的，Environment 是 Configuration 中的一部分，而 PooledDataSource 和 JdbcTransactionFactory 又是 Environment 中的一部分，它们是属于层层递进的关系。其中 JdbcTransactionFactory 表示事务工厂，当 MyBatis 需要新建事务的时候，会通过它来新建；PooledDataSource 表示数据源，通过其构造参数，我们传入了数据库 url，数据库用户和密码等配置；Configuration 可以有多个 Environment，因此每个 Environment 都必须有唯一的 id，即代码中的 development，将这些配置搭配组合后就是一个可用的 Configuration。</li>
<li>通过 Configuration 来创建 <code>SqlSessionFactory</code>。MyBatis 是通过会话的方式来执行 SQL 的，因为我们必须拥有一个会话创建器，即会话工厂。</li>
<li>新建<code>SqlSession</code>来执行 SQL。有了 SqlSessionFactory 后，我们就可以方便地新建会话，并通过会话来执行 SQL 了。</li>
</ol>
<p>而<code>PreparedStatement</code>及以下的内容，其实并不属于 MyBatis，它们是 JDBC 提供的，在实际的 MyBatis 开发中，你也不会这样去执行 SQL，在这里我们只是为了展示 MyBatis 和 JDBC 的关系。</p>
<p>可以看到，编程式使用 MyBatis 其实是比较复杂，你需要十分熟悉 MyBatis 的 API，而且这种硬编码的方式是比较笨重的，所以绝大多数资料都推荐配置的方式使用 MyBatis。</p>
<h2 id="配置式使用"><a href="#配置式使用" class="headerlink" title="配置式使用"></a>配置式使用</h2><p>接下来，我们一起来看一下如何通过配置来使用 MyBatis。</p>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>首先，我们在<code>resources</code>目录下新建<code>mybatis-config.xml</code>配置文件，并在其中添加上如下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatisdemo?useSSL=false<span class="symbol">&amp;amp;</span>serverTimezone = GMT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>有了上面编程式 API 的使用经验，那么你一定可以轻松的看懂配置项，<code>configuration</code> 标签对应 Configuration 类，<code>environment</code> 标签对应 Environment 类，<code>transactionManager</code>标签和<code>dataSource</code>标签分别对应 JdbcTransactionFactory 和 PooledDataSource 类。</p>
<p>有了配置文件后，我们无需一个挨着一个的新建类，而是在配置文件中指定即可，如<code>driver</code>的值指定为<code>com.mysql.cj.jdbc.Driver</code>。当后续需要修改的时候，也不需要去代码中找，而是直接在配置文件中修改即可。</p>
<blockquote>
<p><strong>TIPS：</strong> 注意， 请在你自己的配置文件中修改数据库配置，以满足你自己的数据库环境。</p>
</blockquote>
<h3 id="启动-MyBatis-1"><a href="#启动-MyBatis-1" class="headerlink" title="启动 MyBatis"></a>启动 MyBatis</h3><p>同样地，我们在 patter 包下新建另一个类，名为<code>StartWithXml.java</code>，并填充以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;SqlResolve&quot;, &quot;SqlNoDataSourceInspection&quot;, &quot;Duplicates&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartWithXml</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, SQLException </span>&#123;</span><br><span class="line">    <span class="comment">// 配置式使用MyBatis</span></span><br><span class="line">    String resource = <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">    <span class="comment">// 读取配置文件</span></span><br><span class="line">    InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">    <span class="comment">// 按照配置文件得到 SqlSessionFactory</span></span><br><span class="line">    SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">    <span class="comment">// 新建会话</span></span><br><span class="line">    SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">    <span class="comment">// 执行SQL</span></span><br><span class="line">    PreparedStatement preStatement = session.getConnection().prepareStatement(<span class="string">&quot;SELECT * FROM user WHERE id = ?&quot;</span>);</span><br><span class="line">    preStatement.setInt(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    ResultSet result = preStatement.executeQuery();</span><br><span class="line">    <span class="keyword">while</span> (result.next()) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;username: &quot;</span> + result.getString(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 关闭会话</span></span><br><span class="line">    session.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行代码，你会看到跟上面一样的结果。</p>
<h3 id="使用流程-1"><a href="#使用流程-1" class="headerlink" title="使用流程"></a>使用流程</h3><p>配置式使用 MyBatis，也可分为<code>3</code>步：</p>
<ol>
<li>读取配置文件，即<code>mybatis-config.xml</code>。</li>
<li>通过配置文件来创建 <code>SqlSessionFactory</code>。</li>
<li>新建<code>SqlSession</code>来执行 SQL。</li>
</ol>
<p>与编程式相比，配置式更为简洁，更易维护，所以使用广泛，几乎所有资料都推荐这种方式来使用 MyBatis。但是编程式并非没有意义，它可以帮助你梳理 MyBatis 结构，有了编程式的基础，你才能更加容易地看懂配置文件中的内容，在后续的学习中，我们都将默认地使用配置式。</p>
<h2 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h2><ul>
<li>在实际的开发中，你都少有机会去按照本小节的方式去使用 MyBatis，但是这对你<code>深入理解MyBatis</code>结构有重要作用。</li>
<li>编程式使用的 API 较多，我们没有必要去死记硬背，熟练掌握其使用流程，能在需要的时候查阅即可。</li>
</ul>
<h1 id="MyBatis-mapper"><a href="#MyBatis-mapper" class="headerlink" title="MyBatis mapper"></a>MyBatis mapper</h1><h2 id="前言-2"><a href="#前言-2" class="headerlink" title="前言"></a>前言</h2><p>本小节，我们将一起学习 MyBatis mapper。</p>
<p>在上一节中我们以 JDBC 的方式使用了 MyBatis，但在实际应用中是不会选择这种方式来执行 SQL 的，MyBatis提供了 mapper 这种<code>优雅且易维护</code>的方式来帮助我们更好地去使用 SQL。</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>mapper 是 Java 方法和 SQL 语句之间的<code>桥梁</code>。</p>
</blockquote>
<p>Java 接口方法与 SQL 语句以及 mapper 之间的关系如下图所示：</p>
<p><img src="https://s2.loli.net/2021/12/25/3fQxWmEFtY5lM16.png" alt="图片描述"></p>
<h2 id="新建-mapper"><a href="#新建-mapper" class="headerlink" title="新建 mapper"></a>新建 mapper</h2><p>mapper 只是一个抽象的<code>概念</code>，它其实就是 Java 里面的一个接口类，我们不需要实现这个接口类，MyBatis 会通过动态代理自动帮我们执行接口方法所对应的 SQL 语句。</p>
<p>接下来，我们以<code>UserMapper</code>为例，来看一看 mapper 究竟是如何定义和组成的。</p>
<p>首先，在 com.ahao.mybatis 包下新建 <code>mapper</code>包，并在 mapper 包下新建接口类<code>UserMapper.java</code>。如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyBatis 提供了<code>注解</code>和<code>XML</code>两种方式来连接接口方法和 SQL 语句。</p>
<h3 id="注解方式"><a href="#注解方式" class="headerlink" title="注解方式"></a>注解方式</h3><p>我们为 UserMapper 添加一个方法<code>selectUsernameById</code>，该方法的作用为<strong>通过用户 id 查询用户名称</strong>，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="function">String <span class="title">selectUsernameById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>selectUsernameById 方法接受 id 参数（用户 id），返回用户名称（String 类型）。</p>
<p>有了方法定义后，我们再通过注解为该方法添加上对应的 SQL 语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Select(&quot;SELECT username FROM user WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function">String <span class="title">selectUsernameById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Select</code>注解对应 SQL 的 select 查询，注解中的语句就是相应的 SQL 语句，当然这并非真实的 SQL 语句，具体的差异性我们后续章节再说。</p>
<h3 id="XML-方式"><a href="#XML-方式" class="headerlink" title="XML 方式"></a>XML 方式</h3><p>XML 方式是更加强大和易用的一种方式，虽然它没有注解那么方便，但是功能更强、更易维护，是 MyBatis 官方推荐的一种方式。</p>
<p>在 mapper 包中，我们新建另一个文件<code>UserMapper.xml</code>，并添加如下内容：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.ahao.mybatis.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>mapper</code> 标签对应一个 mapper 接口类，这里应该对应 UserMapper，所以在 mapper 标签里面我们还需要加上 namespace 这个属性，它的值为 UserMapper 的类全路径，这样 UserMapper.xml 配置文件就与 UserMapper.java 对应起来了。</p>
<p><strong>提示</strong>，<strong>namespace 命名空间是每一个 mapper 文件所独有的，它唯一标识着一个 mapper</strong>。</p>
<blockquote>
<p><strong>注意：</strong> 在这里，.xml 配置文件必须与其对应的接口在同一个包内。</p>
</blockquote>
<p>二者在目录中的位置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src&#x2F;main&#x2F;java&#x2F;com&#x2F;ahao&#x2F;mybatis&#x2F;mapper</span><br><span class="line">├── UserMapper.java</span><br><span class="line">└── UserMapper.xml</span><br></pre></td></tr></table></figure>

<p>在 UserMapper 接口中，我们再新增一个方法<code>selectUserAgeById</code>，该方法的作用是<strong>通过用户 id 查询用户年龄</strong>。如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Select(&quot;SELECT username FROM user WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">  <span class="function">String <span class="title">selectUsernameById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function">Integer <span class="title">selectUserAgeById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>与之对应的 xml 文件中，我们也需要添加上对应的 SQL 语句。如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.ahao.mybatis.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserAgeById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">    SELECT age FROM user WHERE id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 mapper 标签中，我们新增了 select 标签，对应 SQL 中的 select 查询；select 标签中有两个必填属性，第一个是 id ，它对应接口的方法名，即 selectUserAgeById，通过它 MyBatis 才能将二者对应起来，第二个是 resultType，它对应 SQL 语句的返回类型，与接口方法的返回值相同，为 Integer 类型。</p>
<p>好了，注解和 XML 的两种方式的简单使用已经介绍完毕了，这里仍然有一个可以完善的点，我们可以为 UserMapper 类打上一个 <code>Mapper</code>注解，虽然这个注解并不是必须的，但是增强了代码的可读性。如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略</span></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 省略其它诸多代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="使用-mapper"><a href="#使用-mapper" class="headerlink" title="使用 mapper"></a>使用 mapper</h2><p>mapper 定义好以后，我们接下来会介绍如何使用它。在上一节中，我们介绍了 MyBatis 配置式的简单使用，那么使用 mapper 其实很简单，只需在配置式使用的基础上增加几处配置和代码就行了。</p>
<h3 id="mapper-配置"><a href="#mapper-配置" class="headerlink" title="mapper 配置"></a>mapper 配置</h3><p>首先，我们需要在 mybatis-config.xml 配置文件中添加上对应的 mapper 配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatisdemo?useSSL=false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  mapper 对应的配置  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.ahao.mybatis.mapper.UserMapper&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意，mapper 可以有多个，对应的标签项应是 mappers，在 mappers 下面才有一个个的 mapper，如上面的 UserMapper；通过mapper 标签中的 class 属性，我们指定其对应的接口类，class 属性值为 UserMapper 的类全路径。</p>
<h3 id="代码调用"><a href="#代码调用" class="headerlink" title="代码调用"></a>代码调用</h3><p>有了配置以后，我们则可以在代码中调用 mapper 方法从而执行 SQL 得到结果了。在 pattern 包下，我们新建一个文件，名为<code>StartWithMapper.java</code>，并向其中添加如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;Duplicates&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StartWithMapper</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, SQLException </span>&#123;</span><br><span class="line">    String resource = <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">    InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">    SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">    <span class="comment">// 得到 mapper</span></span><br><span class="line">    UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">// 调用注解的SQL</span></span><br><span class="line">    String username = mapper.selectUsernameById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;username: &quot;</span> + username);</span><br><span class="line">    <span class="comment">// 调用XML的SQL</span></span><br><span class="line">    Integer age = mapper.selectUserAgeById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;age: &quot;</span> + age);</span><br><span class="line">    <span class="comment">// 关闭会话</span></span><br><span class="line">    session.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用流程我们已经写在了代码注释中了，请务必阅读一下。</p>
<p>与上一节的区别在于，我们不再通过 session 得到连接从而执行 SQL 了，而是在 session 中得到配置好的 UserMapper，再通过调用UserMapper 的方法执行 SQL 从而得到结果。</p>
<p>执行这段代码，它会在控制台上打印如下信息（截取了部分重要信息）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">13:13:50.104 [main] DEBUG com.ahao.mybatis.mapper.UserMapper.selectUsernameById - &#x3D;&#x3D;&gt;  Preparing: SELECT username FROM user WHERE id &#x3D; ? </span><br><span class="line">13:13:50.205 [main] DEBUG com.ahao.mybatis.mapper.UserMapper.selectUsernameById - &#x3D;&#x3D;&gt; Parameters: 1(Integer)</span><br><span class="line">13:13:50.344 [main] DEBUG com.ahao.mybatis.mapper.UserMapper.selectUsernameById - &lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">username: peter</span><br><span class="line">13:13:50.351 [main] DEBUG com.ahao.mybatis.mapper.UserMapper.selectUserAgeById - &#x3D;&#x3D;&gt;  Preparing: SELECT age FROM user WHERE id &#x3D; ? </span><br><span class="line">13:13:50.351 [main] DEBUG com.ahao.mybatis.mapper.UserMapper.selectUserAgeById - &#x3D;&#x3D;&gt; Parameters: 1(Integer)</span><br><span class="line">13:13:50.354 [main] DEBUG com.ahao.mybatis.mapper.UserMapper.selectUserAgeById - &lt;&#x3D;&#x3D;      Total: 1</span><br><span class="line">age: 18</span><br></pre></td></tr></table></figure>



<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>从程序输出的信息中可以看出，UserMapper 的调用都成功了， 结合上一小节中 JDBC 的使用，可以清晰地感受到 MyBatis 完美的将 Java 对象与 SQL 语句分离，并通过 mapper 充当二者的桥梁，极大的提升了代码和 SQL 语句的维护性。</p>
<p>不同于原生 JDBC 的使用方式，MyBatis 会自动的通过 resultType 等配置来帮我们实现数据库类型到 Java 类型的转换，帮我们节省了大量的工作，当然 MyBatis 的功能远不止如此，我们将在后续的小节中一一揭晓。</p>
<h2 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h2><ul>
<li>mapper 是 MyBatis 的核心概念，是 MyBatis <code>解耦</code> Java 对象与 SQL 语句的桥梁。</li>
<li>MyBatis 官方文档中明确<code>强调</code>注解方式 SQL 无法发挥 MyBatis 的全部功能，但是可以方便地演示一些 demo。</li>
<li>如果单独使用 MyBatis，那么 mapper 接口必须和 .xml 配置文件在同一个包中，但是如果使用 spring 等工具就可以不必受此限制。</li>
</ul>
<h1 id="MyBatis-select"><a href="#MyBatis-select" class="headerlink" title="MyBatis select"></a>MyBatis select</h1><h2 id="前言-3"><a href="#前言-3" class="headerlink" title="前言"></a>前言</h2><p>本小节，我们将一起学习 MyBatis select。</p>
<p>在 MyBatis 中，select 标签对应于 SQL 语句中的 select 查询，我们会在 select 标签中填充 SQL 查询语句，然后在代码中通过对应接口方法来调用。</p>
<h2 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>select 标签用于映射 SQL 中的<code>查询</code>语句</p>
</blockquote>
<h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><p>MyBatis select 可分为<code>xml</code>和<code>注解</code>两种使用方式。</p>
<h3 id="xml-实例"><a href="#xml-实例" class="headerlink" title="xml 实例"></a>xml 实例</h3><p>将 select 查询写在 mapper.xml 文件中，比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.ahao.mybatis.mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserAgeById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">    SELECT age FROM user WHERE id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中名为 selectUserAgeById 的 select 标签(一般以 id 做为名称)，接收 Integer 类型的参数（parameterType），并返回 Integer 类型的结果（resultType）；再看 select 标签中的查询语句，接收 id 参数，类型为 int，返回 age，类型为 int，二者一一对应。</p>
<h3 id="参数符号"><a href="#参数符号" class="headerlink" title="参数符号"></a>参数符号</h3><p>注意，在 select 标签中的 SQL 语句几乎与真实的 SQL 语句一致，但它的参数符号稍有不同：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&#123;id&#125;</span></span><br></pre></td></tr></table></figure>

<p>若以 <code>#&#123;&#125;</code>作为参数符号，MyBatis 则会创建一个预处理语句（PreparedStatement），它会被处理成<code>?</code>。如果你不希望使用预处理，那么可以使用<code>$&#123;&#125;</code>参数符号，MyBatis 会将其以字符串的形式进行拼接，不过我们推荐你使用 <code>#&#123;&#125;</code>，几乎所有人也都这样做。</p>
<h3 id="注解实例"><a href="#注解实例" class="headerlink" title="注解实例"></a>注解实例</h3><p>将 SQL 语句写在注解中，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;SELECT username FROM user WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function">String <span class="title">selectUsernameById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>注解中的 select 语句无需再添加 id、parameterType 等属性，只需写上对应的 SQL 语句，MyBatis 会自动根据其修饰的方法来推断出这些参数。</p>
<blockquote>
<p><strong>TIPS：</strong> 使用注解来书写 MyBatis 相对会方便一些，但是注解无法发挥 MyBatis 动态 SQL 真正的威力，因此大部分人都还是会选择 xml 的方式来书写 SQL，但是对于一些 demo 的展示，注解无疑容易上手一些。在后面的学习中，我们都会介绍到注解的使用，但是在实践中我们默认使用 xml 方式。</p>
</blockquote>
<h2 id="select-属性"><a href="#select-属性" class="headerlink" title="select 属性"></a>select 属性</h2><p>select 标签支持很多属性来改变查询语句的行为。</p>
<p>我们摘取其中常见且重要的属性，如下表所示：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">在命名空间中唯一的标识符</td>
</tr>
<tr>
<td align="left">parameterType</td>
<td align="left">语句的参数类型，默认可选，MyBatis 会自动推断</td>
</tr>
<tr>
<td align="left">resultType</td>
<td align="left">语句返回值类型，如果返回的是集合，那应该设置为集合包含的类型</td>
</tr>
<tr>
<td align="left">resultMap</td>
<td align="left">语句返回映射的 id；可以使用 resultType 或 resultMap，但不能同时使用。</td>
</tr>
<tr>
<td align="left">flushCache</td>
<td align="left">设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认为 false</td>
</tr>
<tr>
<td align="left">useCache</td>
<td align="left">设置为 true 后，本条语句的查询结果被二级缓存缓存起来，默认 select 标签为 true。</td>
</tr>
<tr>
<td align="left">timeout</td>
<td align="left">设置超时时间</td>
</tr>
<tr>
<td align="left">fetchSize</td>
<td align="left">设置预期返回的记录数量</td>
</tr>
<tr>
<td align="left">statementType</td>
<td align="left">STATEMENT，PREPARED 或 CALLABLE 中的一个，默认为 PREPARED（预处理）</td>
</tr>
</tbody></table>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>在上面的实例中，我们介绍了<code>#&#123;id&#125;</code>参数，这是参数的最简单情况，对于复杂情况，参数还有其它更多的妙用。</p>
<h3 id="对象参数"><a href="#对象参数" class="headerlink" title="对象参数"></a>对象参数</h3><p>有时候，参数可以是一个复杂的对象，如 Java 中的一个 User 类。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByAgeAndScore&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE age = #&#123;age&#125; AND score = #&#123;score&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>selectUserByAgeAndScore 查询的参数是一个复杂 Java 对象 User，当 User 作为参数对象时，User 中的属性都可作为查询语句的参数，如 age 和 score。</p>
<h3 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h3><p><code>#&#123;&#125;</code>不仅可以传入参数名称，还可以传入参数类型和类型处理器。</p>
<p>比如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#&#123;age,javaType=int,jdbcType=int,typeHandler=IntegerTypeHandler&#125;</span></span><br></pre></td></tr></table></figure>

<p>其中 javaType 表示 age 的 Java 类型，jdbcType 表示 age 的数据库类型，typeHandler 表示 age 的类型处理器，关于类型处理器我们将在后面的章节介绍。</p>
<p>对于参数配置，90% 的情况你都只需要传入参数名即可，因为 MyBatis 都会自动推断出配置。</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p>介绍了这么多概念，我们一起来实操巩固一下。</p>
<h3 id="例1-通过年龄和分数查询用户"><a href="#例1-通过年龄和分数查询用户" class="headerlink" title="例1. 通过年龄和分数查询用户"></a>例1. 通过年龄和分数查询用户</h3><p>请使用 MyBatis 完成在 user 表中通过<code>年龄</code>和<code>分数</code>查询用户的功能。</p>
<p><strong>分析：</strong></p>
<p>按照 MyBatis 的开发模式，先在对应 UserMapper.xml 文件中添加通过年龄和分数查询用户的 select 标签，然后在 UserMapper.java 中增加上对应的方法即可。</p>
<p><strong>步骤：</strong></p>
<p>首先，我们在 com.ahao.mybatis 包下新建 model 包，用于保存数据库对象，并在 model 包下新建 User.java 类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">  <span class="keyword">private</span> Integer score;</span><br><span class="line">  <span class="comment">// 省略了 getter 和 setter 方法，请务必通过 IDE 生成，否则 MyBatis 无法自动映射</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 UserMapper.xml 文件中，我们新增 selectUserByAgeAndScore 标签，该 select 标签的作用是：通过年龄和分数查询用户。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByAgeAndScore&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE age = #&#123;age&#125; AND score = #&#123;score&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后在 UserMapper.java 接口中，我们新增对应的方法，方法接收复杂参数 User：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="function">User <span class="title">selectUserByAgeAndScore</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 selectUserByAgeAndScore 方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&#123;&quot;Duplicates&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, SQLException </span>&#123;</span><br><span class="line">        String resource = <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">        SqlSession session = sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">// 得到 mapper</span></span><br><span class="line">        UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">        User condition = <span class="keyword">new</span> User();</span><br><span class="line">        condition.setAge(<span class="number">18</span>);</span><br><span class="line">        condition.setScore(<span class="number">100</span>);</span><br><span class="line">        <span class="comment">// 调用方法</span></span><br><span class="line">        User user = userMapper.selectUserByAgeAndScore(condition);</span><br><span class="line">        <span class="comment">// 得到 user</span></span><br><span class="line">        System.out.println(user);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输出结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User&#123;id&#x3D;1, username&#x3D;&#39;peter&#39;, age&#x3D;18, score&#x3D;100&#125;</span><br></pre></td></tr></table></figure>



<h2 id="小结-3"><a href="#小结-3" class="headerlink" title="小结"></a>小结</h2><ul>
<li>MyBatis 虽然提供了 <code>#&#123;&#125;</code>和<code>$&#123;&#125;</code>两种方式来传递参数，但无疑<code>#&#123;&#125;</code>更加实用。</li>
<li>select 标签属性虽然多，但是大部分情况下都不会针对某一个 select 标签来定制化，多会在全局里进行配置。</li>
<li>互联网的应用场景多数为读多写少，那么 select 肯定是使用<code>最为广泛</code>的标签了。</li>
</ul>
<h1 id="MyBatis-resultMap-与-sql"><a href="#MyBatis-resultMap-与-sql" class="headerlink" title="MyBatis resultMap 与 sql"></a>MyBatis resultMap 与 sql</h1><h2 id="前言-4"><a href="#前言-4" class="headerlink" title="前言"></a>前言</h2><p>本小节，我们将一起学习 MyBatis resultMap 和 sql。</p>
<p>在前面的小节中，我们了解到 MyBatis 可以自动帮助我们映射数据库数据和 Java 对象，其实这是 MyBatis 在幕后帮我们创建了 resultMap 对象；虽然 MyBatis 可以自动帮助我们做数据映射，但是对于复杂的对象，我们就必须自定义 resultMap 了。</p>
<p>而在书写 SQL 时，势必会有一些 SQL 代码段出现了重复，为了更好的复用它们，MyBatis 提供了 sql 标签。</p>
<h2 id="定义-2"><a href="#定义-2" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>resultMap 标签用于将数据库数据<code>映射</code>为 Java 对象；sql 标签则用来定义<code>可重用</code>的 SQL 代码段。</p>
</blockquote>
<h2 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h2><h3 id="resultMap-实例"><a href="#resultMap-实例" class="headerlink" title="resultMap 实例"></a>resultMap 实例</h3><h4 id="xml-实例-1"><a href="#xml-实例-1" class="headerlink" title="xml 实例"></a>xml 实例</h4><p>在下面这段 select 标签中，SQL 语句返回的是一个复杂对象，即 resultType 上指定的 User。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByAgeAndScore&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE age = #&#123;age&#125; AND score = #&#123;score&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这种情况下，MyBatis 会自动创建 resultMap 对象进行数据的映射，接下来我们直接定义出 resultMap，避免 MyBatis 推断和映射带来的性能损耗。如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;score&quot;</span> <span class="attr">column</span>=<span class="string">&quot;score&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByAgeAndScore&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user WHERE age = #&#123;age&#125; AND score = #&#123;score&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们定义了名为 userMap 的 resultMap 且指定其对应的 Java 类型为 User，在标签的内部，我们还需指定字段之间的映射，除 id 这个特殊的字段外，其它字段均使用 result 标签来映射。</p>
<p>其中 property 是 Java 对象中的字段名称，column 是数据表与之对应的字段名称。</p>
<p>resultMap 定义完毕后，我们在 select 标签中通过 resultMap 属性来设置对应的 id。</p>
<blockquote>
<p><strong>TIPS：</strong> 注意， resultMap 和 resultType 不能共存，只能二选一。</p>
</blockquote>
<p>这样，一次简单的 resultMap 使用就完毕了。</p>
<h4 id="注解实例-1"><a href="#注解实例-1" class="headerlink" title="注解实例"></a>注解实例</h4><p>通过注解，我们也可以指定 Java 模型对象与数据库字段之间的映射关系，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">  @Result(property = &quot;id&quot;, column = &quot;id&quot;, id = true),</span></span><br><span class="line"><span class="meta">  @Result(property = &quot;username&quot;, column = &quot;username&quot;),</span></span><br><span class="line"><span class="meta">  @Result(property = &quot;age&quot;, column = &quot;age&quot;),</span></span><br><span class="line"><span class="meta">  @Result(property = &quot;score&quot;, column = &quot;score&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="meta">@Select(&quot;SELECT * FROM user WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function">User <span class="title">selectUserById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>Results 注解与 resultMap 对象，包含多个 Result 注解，每个 Result 注解对应了一个字段映射关系。</p>
<blockquote>
<p><strong>提示：</strong> Results 注解以及 ResultMap 注解虽然存在，但是很少在实际的开发中使用，只需了解即可。</p>
</blockquote>
<h3 id="SQL-实例"><a href="#SQL-实例" class="headerlink" title="SQL 实例"></a>SQL 实例</h3><p>我们将目光放到 selectUserByAgeAndScore 语句的内部，在实际的开发中像<code>SELECT * FROM user</code>这样的代码段其实非常常见，会在多个 select 标签中用到它。我们可以将其定义为一个 sql 标签，这样所有的 select 标签都可以快速复用到这段代码。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;selectUser&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM user</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同样的，我们必须为这个代码段定义一个唯一的 id，定义好后，我们就可以在其它标签中使用了：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByAgeAndScore&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectUser&quot;</span>/&gt;</span></span><br><span class="line">  WHERE age = #&#123;age&#125; AND score = #&#123;score&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里，我们必须使用一个 include 标签来将 SQL 标签包含进来，并且 refid 属性必须是该 SQL 标签的 id 值。这样这段代码仍然可以正常工作。</p>
<p>SQL 标签没有对应注解，<code>只能</code>在 xml 中使用。</p>
<h2 id="实践-1"><a href="#实践-1" class="headerlink" title="实践"></a>实践</h2><p>接下来，我们一起来实操巩固一下。</p>
<h3 id="例1-查询用户姓名和年龄"><a href="#例1-查询用户姓名和年龄" class="headerlink" title="例1. 查询用户姓名和年龄"></a>例1. 查询用户姓名和年龄</h3><p>请使用 MyBatis 完成在 user 表中查询用户简略信息的功能。</p>
<p><strong>分析：</strong></p>
<p>很多应用都会有查询用户简略信息这样一个需求，比如我们只需获取用户名和年龄，运用本小节的知识我们可以这样实现它。</p>
<p>先在对应 UserMapper.xml 文件中添加查询用户简略信息的 select 标签，然后在 UserMapper.java 中增加上对应的方法即可。</p>
<p><strong>步骤：</strong></p>
<p>首先，我们新建一个用户简略信息的模型 UserShortCut.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserShortCut</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">  <span class="comment">// 省略了重要的 getter 和 setter 方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>并在 UserMapper.xml 添加上 resultMap 、sql 和 select 标签：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  复用的 sql 代码段   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;selectUserShortcutMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT username,age FROM user</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  结果映射集   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userShortcutMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.ahao.mybatis.model.UserShortCut&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--  查询语句   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserShortcutById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userShortcutMap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;selectUserShortcutMap&quot;</span>/&gt;</span></span><br><span class="line">  WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来，给 UserMapper.java 接口添加上对应的方法，以便在程序中调用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.UserShortCut;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="function">UserShortCut <span class="title">selectUserShortcutById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 selectUserShortcutById 方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">UserShortCut shortCut = userMapper.selectUserShortcutById(<span class="number">1</span>);</span><br><span class="line">System.out.println(shortCut);</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UserShortCut&#123;username=<span class="string">&#x27;peter&#x27;</span>, age=18&#125;</span><br></pre></td></tr></table></figure>



<h2 id="小结-4"><a href="#小结-4" class="headerlink" title="小结"></a>小结</h2><ul>
<li>SQL 是一个非常好用的标签，能够减少大量重复的 SQL 代码书写，但是也降低 SQL 的可读性。</li>
<li>MyBatis 会自动生成 resultMap，这会为我们节省了大量的时间，如果不是对性能十分严苛，那么 resultType 是够用的。</li>
</ul>
<h1 id="MyBatis-insert"><a href="#MyBatis-insert" class="headerlink" title="MyBatis insert"></a>MyBatis insert</h1><h2 id="前言-5"><a href="#前言-5" class="headerlink" title="前言"></a>前言</h2><p>本小节，我们将一起学习 MyBatis insert。</p>
<p>在 MyBatis 中，insert 标签对应于 SQL 语句中的 insert 插入；与 select 相比，insert 要简单许多，只有当需要返回主键时，才会麻烦一些，我们将从简单到复杂来依次介绍。</p>
<h2 id="定义-3"><a href="#定义-3" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>insert 标签用于映射 SQL 中的<code>插入</code>语句</p>
</blockquote>
<h2 id="实例-2"><a href="#实例-2" class="headerlink" title="实例"></a>实例</h2><h3 id="xml-实例-2"><a href="#xml-实例-2" class="headerlink" title="xml 实例"></a>xml 实例</h3><p>下面是一个简单的 insert 标签。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  INSERT INTO imooc_user(id,username,age,score) VALUES (#&#123;id&#125;,#&#123;username&#125;,#&#123;age&#125;,#&#123;score&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>同 select 一样，每一个 insert 标签都必须有一个唯一的 id 和可选的 parameterType。标签里面则是真正的 SQL 语句，该语句共有 4 个参数，分别对应 User 类的四个属性。</p>
<h3 id="注解实例-2"><a href="#注解实例-2" class="headerlink" title="注解实例"></a>注解实例</h3><p>如果不使用 xml 的方式，使用注解也可取得同样的效果，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;INSERT INTO imooc_user(username,age,score) VALUES (#&#123;username&#125;,#&#123;age&#125;,#&#123;score&#125;)&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>



<h2 id="insert-属性"><a href="#insert-属性" class="headerlink" title="insert 属性"></a>insert 属性</h2><p>insert 标签也支持诸多属性来改变语句的行为。</p>
<p>其中常见且重要的属性如下表：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">在命名空间中的唯一标识符</td>
</tr>
<tr>
<td align="left">parameterType</td>
<td align="left">语句的参数类型，默认可选，MyBatis 会自动推断</td>
</tr>
<tr>
<td align="left">flushCache</td>
<td align="left">设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认为 false</td>
</tr>
<tr>
<td align="left">timeout</td>
<td align="left">设置超时时间</td>
</tr>
<tr>
<td align="left">statementType</td>
<td align="left">STATEMENT，PREPARED 或 CALLABLE 中的一个，默认为 PREPARED（预处理）</td>
</tr>
<tr>
<td align="left">useGeneratedKeys</td>
<td align="left">取出由数据库自动生成的主键，仅对支持主键自动生成的数据库有效，默认为 false</td>
</tr>
<tr>
<td align="left">keyProperty</td>
<td align="left">主键的名称，必须与useGeneratedKeys 一起使用，默认未设置</td>
</tr>
</tbody></table>
<h2 id="返回主键"><a href="#返回主键" class="headerlink" title="返回主键"></a>返回主键</h2><p>select 标签在需要返回被添加记录的主键时，会稍微复杂一点。</p>
<h3 id="自增主键"><a href="#自增主键" class="headerlink" title="自增主键"></a>自增主键</h3><h4 id="xml-方式"><a href="#xml-方式" class="headerlink" title="xml 方式"></a>xml 方式</h4><p>如果使用的数据库，如 MySQL，PostgreSQL，这些数据库支持自增主键，那么得到返回的主键只需添加上 useGeneratedKeys 和 keyProperty 两个属性即可。如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUserNoId&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  INSERT INTO user(username,age,score) VALUES (#&#123;username&#125;,#&#123;age&#125;,#&#123;score&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 insertUserNoId 中，我们并未添加上 id 参数，而是使用了数据库自增主键的特性，keyProperty 属性值对应 id 字段的名称，这样当语句执行成功后，对象的 id 字段会被自动设置为返回的 id 值。</p>
<h4 id="注解方式-1"><a href="#注解方式-1" class="headerlink" title="注解方式"></a>注解方式</h4><p>使用下面的注解方式，同样可以实现同样的效果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;INSERT INTO imooc_user(username,age,score) VALUES (#&#123;username&#125;,#&#123;age&#125;,#&#123;score&#125;)&quot;)</span></span><br><span class="line"><span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>

<p>MyBatis 提供了 Options 注解来指定方法调用的行为。</p>
<h3 id="selectKey-标签"><a href="#selectKey-标签" class="headerlink" title="selectKey 标签"></a>selectKey 标签</h3><h4 id="xml-方式-1"><a href="#xml-方式-1" class="headerlink" title="xml 方式"></a>xml 方式</h4><p>如果使用的数据库不支持主键自增，如 Oracle，MyBatis 提供了 selectKey 标签来通过 SQL 语句获得主键。</p>
<p>例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUserNoId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  INSERT INTO imooc_user(username,age,score) VALUES (#&#123;username&#125;,#&#123;age&#125;,#&#123;score&#125;)</span><br><span class="line">  <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyColumn</span>=<span class="string">&quot;id&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;long&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span>&gt;</span></span><br><span class="line">    SELECT LAST_INSERT_ID()</span><br><span class="line">  <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>selectKey 标签必须在 insert 标签里面，selectKey 有 4 个属性，它们的作用如下表：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">keyColumn</td>
<td align="left">数据库字段名，对应返回结果集中的名称</td>
</tr>
<tr>
<td align="left">keyProperty</td>
<td align="left">目标字段名称，对应Java 对象的字段名</td>
</tr>
<tr>
<td align="left">resultType</td>
<td align="left">id字段的类型</td>
</tr>
<tr>
<td align="left">order</td>
<td align="left">执行的顺序，在 insert 之前调用为 BEFORE，之后为 AFTER</td>
</tr>
</tbody></table>
<p>注意，selectKey 中的语句其实就是 SQL 语句，不同数据库得到主键的语句均不一样。</p>
<h4 id="注解方式-2"><a href="#注解方式-2" class="headerlink" title="注解方式"></a>注解方式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;INSERT INTO imooc_user(username,age,score) VALUES (#&#123;username&#125;,#&#123;age&#125;,#&#123;score&#125;)&quot;)</span></span><br><span class="line"><span class="meta">@SelectKey(statement = &quot;SELECT LAST_INSERT_ID()&quot;, keyProperty = &quot;id&quot;, before = false, resultType = Long.class)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>

<p>selectKey 也有相应的注解，不过配置属性略有不同，statement 属性对应标签中的 SQL 语句，而 before 属性则对应标签中的 order 属性，若 before 为 false，则 order 对应为 AFTER。</p>
<h2 id="实践-2"><a href="#实践-2" class="headerlink" title="实践"></a>实践</h2><p>下面，我们一起来实操巩固一下。</p>
<h3 id="例1-插入用户"><a href="#例1-插入用户" class="headerlink" title="例1. 插入用户"></a>例1. 插入用户</h3><p>请使用 MyBatis 完成在 imooc_user 表中插入用户的功能。</p>
<p><strong>分析：</strong></p>
<p>按照 MyBatis 的开发模式，先在对应 UserMapper.xml 文件中添加插入用户的 insert 标签，然后在 UserMapper.java 中增加上对应的方法即可。</p>
<p><strong>步骤：</strong></p>
<p>使用 MyBatis 向数据库中插入用户。由于我们使用的数据库是 MySQL，因为直接使用 useGeneratedKeys 得到自增主键。</p>
<p>首先，我们在 UserMapper.xml 文件中添加上对应的 insert 标签：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  INSERT INTO imooc_user(username,age,score) VALUES (#&#123;username&#125;,#&#123;age&#125;,#&#123;score&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在 UserMapper.java 中添加对应的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 insertUser 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setUsername(<span class="string">&quot;insert test&quot;</span>);</span><br><span class="line">user.setAge(<span class="number">100</span>);</span><br><span class="line">user.setScore(<span class="number">100000</span>);</span><br><span class="line"><span class="keyword">int</span> rows = userMapper.insertUser(user);</span><br><span class="line">System.out.println(rows);</span><br><span class="line"><span class="comment">// 一定要提交</span></span><br><span class="line">session.commit();</span><br><span class="line">session.close();</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>TIPS:</strong> 注意，这里必须通过 commit 方法提交会话，语句才会生效。</p>
</blockquote>
<h2 id="小结-5"><a href="#小结-5" class="headerlink" title="小结"></a>小结</h2><ul>
<li>绝大多数情况下，我们都不会在插入时指定 id 的值，而是通过数据库自动去生成。</li>
<li>不同数据库获得主键的 SQL 语句也不同，如果通过 selectKey 获得主键，那么一定要注意数据库厂商之间的差异性。</li>
</ul>
<h1 id="MyBatis-update"><a href="#MyBatis-update" class="headerlink" title="MyBatis update"></a>MyBatis update</h1><h2 id="前言-6"><a href="#前言-6" class="headerlink" title="前言"></a>前言</h2><p>本小节，我们将一起学习 MyBatis update。</p>
<p>在 MyBatis 中，update 标签对应于 SQL 语句中的 update 更新。</p>
<h2 id="定义-4"><a href="#定义-4" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>update 标签用于映射 SQL 中的<code>更新</code>语句。</p>
</blockquote>
<h2 id="实例-3"><a href="#实例-3" class="headerlink" title="实例"></a>实例</h2><h3 id="xml-实例-3"><a href="#xml-实例-3" class="headerlink" title="xml 实例"></a>xml 实例</h3><p>如下就是一个真实的 update 标签实例。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserAgeById&quot;</span>&gt;</span></span><br><span class="line">  UPDATE imooc_user SET age = #&#123;age&#125; WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>每一个 update 标签都必须有一个唯一的 id 属性，在 update 标签内部则是一条 SQL 语句。</p>
<h3 id="注解实例-3"><a href="#注解实例-3" class="headerlink" title="注解实例"></a>注解实例</h3><p>使用如下的注解方式，我们也可以实现同样的功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Update(&quot;UPDATE imooc_user SET age = #&#123;age&#125; WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateUserAgeById</span><span class="params">(<span class="meta">@Param(&quot;age&quot;)</span> Integer age, <span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span></span>;</span><br></pre></td></tr></table></figure>



<h2 id="update-属性"><a href="#update-属性" class="headerlink" title="update 属性"></a>update 属性</h2><p>update 标签支持一些属性来改变更新语句的行为。</p>
<p>其中常见且重要的属性如下表：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">在命名空间中的唯一标识符</td>
</tr>
<tr>
<td align="left">parameterType</td>
<td align="left">语句的参数类型，默认可选，MyBatis 会自动推断</td>
</tr>
<tr>
<td align="left">flushCache</td>
<td align="left">设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认为 false</td>
</tr>
<tr>
<td align="left">timeout</td>
<td align="left">设置超时时间</td>
</tr>
<tr>
<td align="left">statementType</td>
<td align="left">STATEMENT，PREPARED 或 CALLABLE 中的一个，默认为 PREPARED（预处理）</td>
</tr>
</tbody></table>
<h2 id="实践-3"><a href="#实践-3" class="headerlink" title="实践"></a>实践</h2><h3 id="例1-更新用户年龄"><a href="#例1-更新用户年龄" class="headerlink" title="例1. 更新用户年龄"></a>例1. 更新用户年龄</h3><p>请使用 MyBatis 完成对 imooc_user 表中用户年龄更新的功能。</p>
<p><strong>分析：</strong></p>
<p>按照 MyBatis 的开发模式，先在对应 UserMapper.xml 文件中添加用户年龄更新的 update 标签，然后在 UserMapper.java 中增加上对应的方法即可。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加 update 标签，并在标签中写入 SQL ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserAgeById&quot;</span>&gt;</span></span><br><span class="line">  UPDATE imooc_user SET age = #&#123;age&#125; WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在 UserMapper.java 中添加上对应的接口方法，方法接受 age 和 id 两个参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">updateUserAgeById</span><span class="params">(<span class="meta">@Param(&quot;age&quot;)</span> Integer age, <span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：这里我们使用了<code>@Param</code>这个注解，由于在 update 标签中有两个参数 age 和 id，我们需要通过 @Param 来告诉 MyBatis 参数的对应关系。</p>
<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 updateUserAgeById 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line"><span class="keyword">int</span> rows = userMapper.updateUserAgeById(<span class="number">180</span>, <span class="number">1</span>);</span><br><span class="line">System.out.println(rows);</span><br><span class="line"><span class="comment">// 一定要提交</span></span><br><span class="line">session.commit();</span><br><span class="line">session.close();</span><br></pre></td></tr></table></figure>

<p>成功后，id 为 1 的用户年龄已经被更新为 180。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-----+--------+</span><br><span class="line">| id | username    | age | score  |</span><br><span class="line">+----+-------------+-----+--------+</span><br><span class="line">| 1  | peter       | 180 | 100    |</span><br><span class="line">+----+-------------+-----+--------+</span><br></pre></td></tr></table></figure>



<h3 id="例2-更新用户名称和分数"><a href="#例2-更新用户名称和分数" class="headerlink" title="例2. 更新用户名称和分数"></a>例2. 更新用户名称和分数</h3><p>请使用 MyBatis 完成对 imooc_user 表中用户名称和分数更新的功能。</p>
<p><strong>分析：</strong></p>
<p>同上。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加另一个 update 标签，并在标签中写入 SQL ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUsernameAndScoreById&quot;</span>&gt;</span></span><br><span class="line">  UPDATE imooc_user SET username = #&#123;username&#125;, score = #&#123;score&#125; WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在 UserMapper.java 中添加上对应的接口方法，方法接受 username、score 和 id 三个参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">updateUsernameAndScoreById</span><span class="params">(<span class="meta">@Param(&quot;username&quot;)</span> String username, <span class="meta">@Param(&quot;score&quot;)</span> Integer score, <span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 updateUsernameAndScoreById 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line"><span class="keyword">int</span> rows = userMapper.updateUsernameAndScoreById(<span class="string">&quot;peter-gao&quot;</span>, <span class="number">1000</span>,<span class="number">1</span>);</span><br><span class="line">System.out.println(rows);</span><br><span class="line"><span class="comment">// 一定要提交</span></span><br><span class="line">session.commit();</span><br><span class="line">session.close();</span><br></pre></td></tr></table></figure>

<p>成功后，id 为 1 的用户信息已被更改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-------------+-----+--------+</span><br><span class="line">| id | username    | age | score  |</span><br><span class="line">+----+-------------+-----+--------+</span><br><span class="line">| 1  | peter-gao   | 180 | 1000   |</span><br><span class="line">+----+-------------+-----+--------+</span><br></pre></td></tr></table></figure>



<h2 id="小结-6"><a href="#小结-6" class="headerlink" title="小结"></a>小结</h2><ul>
<li>update 标签并无太多的知识点，主要的工作量在书写 SQL 上，因此良好的 SQL 功底可以帮助你更加快速的上手 MyBatis。</li>
</ul>
<h1 id="MyBatis-delete"><a href="#MyBatis-delete" class="headerlink" title="MyBatis delete"></a>MyBatis delete</h1><h2 id="前言-7"><a href="#前言-7" class="headerlink" title="前言"></a>前言</h2><p>本小节，我们将一起学习 MyBatis delete。</p>
<p>在 MyBatis 中，delete 标签对应于 SQL 语句中的 delete 删除。</p>
<h2 id="定义-5"><a href="#定义-5" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>delete 标签用于映射 SQL 中的<code>删除</code>语句。</p>
</blockquote>
<h2 id="实例-4"><a href="#实例-4" class="headerlink" title="实例"></a>实例</h2><h3 id="xml-实例-4"><a href="#xml-实例-4" class="headerlink" title="xml 实例"></a>xml 实例</h3><p>如下，是一个真实的 delete 标签实例。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUserById&quot;</span>&gt;</span></span><br><span class="line">  DELETE FROM imooc_user WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>每一个 delete 标签都必须有一个唯一的 id 属性，在 delete 标签内部则是一条 SQL 语句。</p>
<h3 id="注解实例-4"><a href="#注解实例-4" class="headerlink" title="注解实例"></a>注解实例</h3><p>上面的 delete 标签对应的注解实例如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Delete(&quot;DELETE FROM imooc_user WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">deleteUserById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>



<h2 id="delete-属性"><a href="#delete-属性" class="headerlink" title="delete 属性"></a>delete 属性</h2><p>delete 标签支持一些属性来改变更新语句的行为。</p>
<p>其中常见且重要的属性如下表：</p>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">id</td>
<td align="left">在命名空间中的唯一标识符</td>
</tr>
<tr>
<td align="left">parameterType</td>
<td align="left">语句的参数类型，默认可选，MyBatis 会自动推断</td>
</tr>
<tr>
<td align="left">flushCache</td>
<td align="left">设置为 true 后，只要语句被调用，都会导致本地缓存和二级缓存被清空，默认为 false</td>
</tr>
<tr>
<td align="left">timeout</td>
<td align="left">设置超时时间</td>
</tr>
<tr>
<td align="left">statementType</td>
<td align="left">STATEMENT，PREPARED 或 CALLABLE 中的一个，默认为 PREPARED（预处理）</td>
</tr>
</tbody></table>
<h2 id="实践-4"><a href="#实践-4" class="headerlink" title="实践"></a>实践</h2><h3 id="例1-根据-id-删除用户"><a href="#例1-根据-id-删除用户" class="headerlink" title="例1. 根据 id 删除用户"></a>例1. 根据 id 删除用户</h3><p>请使用 MyBatis 完成对 imooc_user 表中通过 id 删除用户的功能。</p>
<p><strong>分析：</strong></p>
<p>按照 MyBatis 的开发模式，先在对应 UserMapper.xml 文件中添加根据 id 删除用户的 delete 标签，然后在 UserMapper.java 中增加上对应的方法即可。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加 delete 标签，并在标签中写入 SQL ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUserById&quot;</span>&gt;</span></span><br><span class="line">  DELETE FROM imooc_user WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在 UserMapper.java 中添加上对应的接口方法，方法接受 id 一个参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">deleteUserById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 deleteUserById 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line"><span class="keyword">int</span> rows = userMapper.deleteUserById(<span class="number">10</span>);</span><br><span class="line">System.out.println(rows);</span><br><span class="line"><span class="comment">// 一定要提交</span></span><br><span class="line">session.commit();</span><br><span class="line">session.close();</span><br></pre></td></tr></table></figure>

<p>成功后，id 为 10 的用户已被删除。</p>
<h3 id="例2-根据用户名删除用户"><a href="#例2-根据用户名删除用户" class="headerlink" title="例2. 根据用户名删除用户"></a>例2. 根据用户名删除用户</h3><p>请使用 MyBatis 完成对 imooc_user 表中通过<code>用户名</code>删除用户的功能。</p>
<p><strong>分析：</strong></p>
<p>同上。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加 delete 标签，并在标签中写入 SQL ：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUserByName&quot;</span>&gt;</span></span><br><span class="line">  DELETE FROM imooc_user WHERE username = #&#123;username&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在 UserMapper.java 中添加上对应的接口方法，方法接受 username 一个参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">deleteUserByName</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 deleteUserByName 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line"><span class="keyword">int</span> rows = userMapper.deleteUserByName(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">System.out.println(rows);</span><br><span class="line">session.commit();</span><br><span class="line">session.close();</span><br></pre></td></tr></table></figure>

<p>成功后，用户名为 tom 的用户已被删除。</p>
<h2 id="小结-7"><a href="#小结-7" class="headerlink" title="小结"></a>小结</h2><ul>
<li>delete 标签并无太多的知识点，主要的工作量在书写 SQL 上。</li>
</ul>
<h1 id="OGNL-表达式"><a href="#OGNL-表达式" class="headerlink" title="OGNL 表达式"></a>OGNL 表达式</h1><h2 id="前言-8"><a href="#前言-8" class="headerlink" title="前言"></a>前言</h2><p>MyBatis 的动态 SQL 广泛应用到了OGNL 表达式，OGNL 表达式可以灵活的组装 SQL 语句，从而完成更多的功能。OGNL 易学易用，与 Java 代码几乎一致，本小节我们将系统的介绍 OGNL 表达式在 MyBatis 中的使用。</p>
<h2 id="定义-6"><a href="#定义-6" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p>OGNL 全称 Object-Graph Navigation Language，是 Java 中的一个开源的表达式语言，用于访问对象数据。</p>
</blockquote>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><h3 id="实例-5"><a href="#实例-5" class="headerlink" title="实例"></a>实例</h3><p>OGNL 最常用于 if 标签中，用于判断条件是否满足，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span></span><br><span class="line">  AND age = #&#123;age&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>if 标签的 test 属性就是个典型的 OGNL 表达式。<code>age != null</code>表示当 age 不为 null 的时候 if 成立，则动态的向 SQL 中插入标签内的 SQL 代码段。</p>
<h3 id="常见的-OGNL-表达式"><a href="#常见的-OGNL-表达式" class="headerlink" title="常见的 OGNL 表达式"></a>常见的 OGNL 表达式</h3><p>在 MyBatis 中常见的 OGNL 表达式如下：</p>
<ol>
<li>e1 or e2：或关系</li>
<li>e1 and e2：与关系</li>
<li>e1 == e2 或者 e1 eq e2：相等</li>
<li>e1 != e2 或者 e1 neq e2：不等</li>
<li>e1 lt e2 ；e1 &lt; e2；e1 gt e2；e1 &gt; e2；e1 lte e2；e1 &lt;= e2；e1 gte e2；e1 &gt;= e2：比较关系</li>
<li>e1 + e2；e1 - e2；e1 * e2；e1 / e2；e1 % e2：运算关系</li>
<li>!e 或者 not e：非，取反</li>
<li>e.method(args)：调用对象方法</li>
<li>e.property：访问属性值</li>
<li>e1[e2]：访问数组、链表（e2 为序号）或者 Map（e2 为键值）</li>
</ol>
<p>其中 1～4 以及 9～10 都是特别常用的几种情况，而其它的情况不利于 SQL 的维护，因此并不常见。</p>
<blockquote>
<p><strong>TIPS：</strong> 提示， 如果你熟悉 Python 的话，会发现 OGNL 表达式完全就是在写 Python。</p>
</blockquote>
<h2 id="实践-5"><a href="#实践-5" class="headerlink" title="实践"></a>实践</h2><p>下面我们就来以实例来看一看 OGNL 表达式。</p>
<p>有一个名为 pedro 的 User 对象，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User pedro = <span class="keyword">new</span> User();</span><br><span class="line">pedro.setUsername(<span class="string">&quot;pedro&quot;</span>);</span><br><span class="line">pedro.setTags(Arrays.asList(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;man&quot;</span>));</span><br><span class="line">pedro.setAge(<span class="number">23</span>);</span><br></pre></td></tr></table></figure>



<h3 id="访问属性"><a href="#访问属性" class="headerlink" title="访问属性"></a>访问属性</h3><p>访问用户的 username 属性，OGNL 表达式为<code>pedro.username</code>，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pedro.username</span></span><br><span class="line">pedro</span><br></pre></td></tr></table></figure>



<h3 id="访问列表"><a href="#访问列表" class="headerlink" title="访问列表"></a>访问列表</h3><p>访问用户的第一个标签，OGNL 表达式为<code>pedro.tags[0]</code>，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pedro.tags[0]</span></span><br><span class="line">admin</span><br></pre></td></tr></table></figure>



<h3 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h3><p>比较用户标签长度是否大于 1，OGNL 表达式为<code>pedro.tags[0]</code>，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pedro.tags.size &gt; 1</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>



<h3 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h3><p>用户年龄加上一个整数 22，OGNL 表达式为<code>pedro.age + 22</code>，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pedro.age + 22</span></span><br><span class="line">45</span><br></pre></td></tr></table></figure>



<h3 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h3><p>将用户年龄全部大写，OGNL 表达式为<code>pedro.username.toUpperCase</code>，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pedro.username.toUpperCase</span></span><br><span class="line">PEDRO</span><br></pre></td></tr></table></figure>



<h2 id="小结-8"><a href="#小结-8" class="headerlink" title="小结"></a>小结</h2><ul>
<li>OGNL 表达式是 MyBatis 动态 SQL 的核心，小巧精致却功能强大，易学易用。</li>
</ul>
<h1 id="MyBatis-if-和多数据库支持"><a href="#MyBatis-if-和多数据库支持" class="headerlink" title="MyBatis if 和多数据库支持"></a>MyBatis if 和多数据库支持</h1><h2 id="前言-9"><a href="#前言-9" class="headerlink" title="前言"></a>前言</h2><p>动态 SQL 是 MyBatis 最标志性的特性之一。在其它框架中，你可能需要根据不同的条件来拼接 SQL，辗转在符号与条件的判断上，处理起来麻烦而且易错，而 MyBatis 的动态 SQL 可以让我们摆脱这种痛苦，简单而又高效的书写 SQL。</p>
<p>MyBatis 动态 SQL 由 OGNL 表达式和条件标签两部 分组成，我们将会分为多个小节进行介绍。</p>
<p>OGNL 表达式是动态 SQL 的基础，如果你还不了解，请务必点击学习一下。条件标签部分我们将会在<code>四个</code>小节中分别介绍，它们分别是MyBatis if 和多数据库支持（本小节），MyBatis choose和bind小节，MyBatis where、set、trim小节和MyBatis foreach小节。</p>
<p>本小节，我们先来学习最基础的条件标签 if，以及如何使用 if 来让 MyBatis 来支持多数据库。</p>
<h2 id="定义-7"><a href="#定义-7" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p><code>if</code> 常用于 where 语句中，通过判断参数来决定在 select 语句中是否使用某个查询条件，或者在 update 语句中判断是否更新一个字段，还可以在 insert 语句中决定是否插入一个满足条件的值。</p>
</blockquote>
<h2 id="实例-6"><a href="#实例-6" class="headerlink" title="实例"></a>实例</h2><p>我们以一个实际的例子来看一下 if 是如何工作的。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByAgeAndScore&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  WHERE age = #&#123;age&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;score != null&quot;</span>&gt;</span></span><br><span class="line">    AND score = #&#123;score&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 if 标签中，test 属性是 OGNL 的判断表达式。</p>
<p>selectUserByAgeAndScore 的作用是通过用户年龄和积分来查询用户，当 score 值为 null 时，if 判断不成立，此时生成的 SQL 语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> imooc_user <span class="keyword">WHERE</span> age <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure>

<p>而当 if 成立时，生成的 SQL 语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> imooc_user <span class="keyword">WHERE</span> age <span class="operator">=</span> ? <span class="keyword">AND</span> score <span class="operator">=</span> ?</span><br></pre></td></tr></table></figure>

<p>通过这样条件判断方式，MyBatis 能根据实际情况来动态生成 SQL 语句。</p>
<h2 id="实践-6"><a href="#实践-6" class="headerlink" title="实践"></a>实践</h2><h3 id="例1、动态查询用户"><a href="#例1、动态查询用户" class="headerlink" title="例1、动态查询用户"></a>例1、动态查询用户</h3><p>请使用 MyBatis 完成对 imooc_user 表动态查询用户的功能， username为必须的查询条件，年龄和积分若为 null 则不使用该字段进行过滤。</p>
<p><strong>分析：</strong></p>
<p>按照 MyBatis 的开发模式，先在 UserMapper.xml 文件中添加动态查询用户的 select 标签，然后在 UserMapper.java 中增加上对应的方法。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加 select 标签，并在标签中写入 SQL，使用 if 来判断属性值是否为 null，若为 null，则不使用该字段进行查询。如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByNameCondition&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  WHERE username = #&#123;username&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span></span><br><span class="line">    AND age = #&#123;age&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;score != null&quot;</span>&gt;</span></span><br><span class="line">    AND score = #&#123;score&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过 if 对属性的判断，SQL 的过滤条件就会发生相应的变化。</p>
<p>然后在 UserMapper.java 中添加上对应的接口方法，方法接受 User对象作为参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function">User <span class="title">selectUserByNameCondition</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 selectUserByNameCondition 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">User condition = <span class="keyword">new</span> User();</span><br><span class="line">condition.setUsername(<span class="string">&quot;pedro&quot;</span>);</span><br><span class="line">condition.setScore(<span class="number">200</span>);</span><br><span class="line">User pedro = userMapper.selectUserByNameCondition(condition);</span><br><span class="line">System.out.println(pedro);</span><br></pre></td></tr></table></figure>

<p>condition 对象 username 和 score 属性均不为空，而 age 属性为空，因此最后所执行的 SQL 为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> imooc_user <span class="keyword">WHERE</span> username <span class="operator">=</span> ? <span class="keyword">AND</span> score <span class="operator">=</span> ? </span><br></pre></td></tr></table></figure>

<p>成功后，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User&#123;id=2, username=<span class="string">&#x27;pedro&#x27;</span>, age=24, score=200&#125;</span><br></pre></td></tr></table></figure>



<h2 id="多数据库支持"><a href="#多数据库支持" class="headerlink" title="多数据库支持"></a>多数据库支持</h2><p>MyBatis 可以根据不同的数据库厂商执行不同的语句，这种多厂商的支持是基于配置文件中的 databaseId。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>首先在 MyBatis 的全局配置文件中添加如下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 configuration 中加入 databaseIdProvider 后，还需要在 databaseIdProvider 标签中添加上需要使用到的数据库名称，如：SQL Server。每一个 property 属性都代表了一个数据库，name 表示数据库厂商名称，value 用来设置别名。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">databaseIdProvider</span> <span class="attr">type</span>=<span class="string">&quot;DB_VENDOR&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;SQL Server&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlserver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;MySQL&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;PostgreSQL&quot;</span> <span class="attr">value</span>=<span class="string">&quot;postgre&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">databaseIdProvider</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>配置完毕后，我们就可以在 mapper xml 文件中，通过 if 来判断当前的数据库厂商，从而动态生成不同数据库的 SQL。</p>
<p>例如，PostgreSQL 支持使用 <code>||</code>来拼接字符串，而 MySQL 需要使用 <code>concat</code>函数来拼接字符串。</p>
<p>因此，如果在模糊查询的时候，不同的数据库厂商需要不同的 SQL 语句，通过 if 来判断数据库厂商来生成对于的 SQL 语句。</p>
<p>如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByLikeName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  WHERE username LIKE</span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;mysql&#x27;&quot;</span>&gt;</span></span><br><span class="line">    CONCAT(&#x27;%&#x27;,#&#123;username&#125;,&#x27;%&#x27;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;postgre&#x27;&quot;</span>&gt;</span></span><br><span class="line">    &#x27;%&#x27; || #&#123;username&#125; || &#x27;%&#x27;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意，这里 _databaseId 参数是由 MyBatis 提供的内置参数，对应于 databaseIdProvider 中配置的数据库名称。</p>
<p>通过 databaseIdProvider 配置，即时数据库厂商之间存在差异，但仍然可以通过动态 SQL 的形式来支持多数据库。</p>
<h2 id="小结-9"><a href="#小结-9" class="headerlink" title="小结"></a>小结</h2><ul>
<li>if 简单且好用，是动态 SQL 中的最基础的标签，一看便会。</li>
<li>多数据库支持的应用场景其实较少，但如果真的需要，也可通过 MyBatis 来方便的实现。</li>
</ul>
<h1 id="MyBatis-choose-和-bind"><a href="#MyBatis-choose-和-bind" class="headerlink" title="MyBatis choose 和 bind"></a>MyBatis choose 和 bind</h1><h2 id="前言-10"><a href="#前言-10" class="headerlink" title="前言"></a>前言</h2><p>在上一小节中，我们介绍了 MyBatis 动态 SQL 中最基础的标签——if 标签，本小节我们将一起学习 choose 和 bind 标签。</p>
<p>choose 标签是 if 标签的增强版，适用于更加复杂的条件判断逻辑；而bind 标签则可以在 OGNL 上下文环境中新绑定一个变量，供后面的 SQL 使用。</p>
<h2 id="定义-8"><a href="#定义-8" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p><code>choose</code> 标签相当于编程语言 if…else 语句，用于动态 SQL 中的多条件判断，是 if 标签的增强版。</p>
<p><code>bind</code> 标签可以在动态 SQL 中通过 OGNL 表达式来创建一个新的变量绑定到上下文中，供后续的 SQL 使用。</p>
</blockquote>
<h2 id="实例-7"><a href="#实例-7" class="headerlink" title="实例"></a>实例</h2><p>下面是一个融合了 choose 和 bind 标签的实例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByLikeName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  WHERE username LIKE</span><br><span class="line">  <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;mysql&#x27;&quot;</span>&gt;</span></span><br><span class="line">      CONCAT(&#x27;%&#x27;,#&#123;username&#125;,&#x27;%&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;_databaseId == &#x27;postgre&#x27;&quot;</span>&gt;</span></span><br><span class="line">      &#x27;%&#x27; || #&#123;username&#125; || &#x27;%&#x27;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;usernameLike&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#x27;%&#x27; + username + &#x27;%&#x27;&quot;</span>/&gt;</span></span><br><span class="line">      #&#123;usernameLike&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过 choose 标签来判断当前的数据库厂商，如果是 MySQL 数据库，则调用<code>CONCAT</code>函数来拼接 % 和 username，如果是 PostgreSQL 数据库，则使用操作符<code>||</code>来拼接，如果是其它类型的数据库，则直接通过 OGNL 表达式来绑定一个新的变量 usernameLike。</p>
<p>在这个例子中，choose 是一个条件选择标签，第一个 when 相当于 if 判断，第二个 when 相当于 else if，最后的 otherwise 相当于 else。比起 if 标签，choose 标签无疑更为易用，适用于同一条件的多次判断逻辑。</p>
<h2 id="实践-7"><a href="#实践-7" class="headerlink" title="实践"></a>实践</h2><h3 id="例1-多条件查询用户"><a href="#例1-多条件查询用户" class="headerlink" title="例1. 多条件查询用户"></a>例1. 多条件查询用户</h3><p>请使用 MyBatis 完成对 imooc_user 表多条件查询用户的功能，如果 id 不为空则直接使用 id 查询用户，否则使用 username 查询用户，如果 username 也为空，则直接查询全部用户。</p>
<p><strong>分析：</strong></p>
<p>按照 MyBatis 的开发模式，需先在 UserMapper.xml 文件中添加多条件查询用户的 select 标签，然后在 UserMapper.java 中添加上对应的方法。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加 select 标签，并在标签中写入 SQL，使用 choose 中的 when 标签来依次判断 id 和 username 是否为 null，若均为 null，则在 otherwise 中添加上一个永假的值。如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByIdOrName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  WHERE</span><br><span class="line">  <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span></span><br><span class="line">      id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">      username = #&#123;username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">      1 = 0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里使用了<code>1 = 0</code>作为条件判断的永假值。</p>
<p>然后在 UserMapper.java 中添加上对应的接口方法，方法接受 id 和 username 两个参数，都可为空。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function">User <span class="title">selectUserByIdOrName</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id, <span class="meta">@Param(&quot;username&quot;)</span> String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 selectUserByIdOrName 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">User pedro = userMapper.selectUserByIdOrName(<span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line">System.out.println(pedro);</span><br></pre></td></tr></table></figure>

<p>id 和 username 两个属性均为空，因此所执行的 SQL 为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> imooc_user <span class="keyword">WHERE</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">0</span> </span><br></pre></td></tr></table></figure>

<p>成功后，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">null</span><br></pre></td></tr></table></figure>



<h3 id="例2-查询小写名称客户"><a href="#例2-查询小写名称客户" class="headerlink" title="例2. 查询小写名称客户"></a>例2. 查询小写名称客户</h3><p>请使用 MyBatis 完成对 imooc_user 表查询小写名称客户的功能，将名称小写后再进行查询。</p>
<p><strong>分析：</strong></p>
<p>同上。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加 select 标签，并在标签中写入 SQL，使用 bind 标签将参数小写化成一个新的变量 lowercaseName。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUsernameLowercase&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">&quot;lowercaseName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;username.toLowercase&quot;</span>/&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  WHERE username = #&#123;lowercaseName&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在 UserMapper.java 中添加上对应的接口方法，方法接受 username 一个参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function">User <span class="title">selectUsernameLowercase</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 selectUsernameLowercase 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">User pedro = userMapper.selectUsernameLowercase(<span class="string">&quot;PEDRO&quot;</span>);</span><br><span class="line">System.out.println(pedro);</span><br></pre></td></tr></table></figure>

<p>成功后，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User&#123;id=2, username=<span class="string">&#x27;pedro&#x27;</span>, age=24, score=200&#125;</span><br></pre></td></tr></table></figure>



<h2 id="小结-10"><a href="#小结-10" class="headerlink" title="小结"></a>小结</h2><ul>
<li>bind 标签虽然可以通过 OGNL 表达式在上下文中绑定一个新的变量，但在实际应用所见不多，我们希望在代码层面上处理好参数，这样既方便维护，也更有利于迁移。</li>
<li>choose 标签是一个增强版的 if 标签，适用于更加复杂的逻辑判断场景。</li>
</ul>
<h1 id="MyBatis-where、set、trim"><a href="#MyBatis-where、set、trim" class="headerlink" title="MyBatis where、set、trim"></a>MyBatis where、set、trim</h1><h2 id="前言-11"><a href="#前言-11" class="headerlink" title="前言"></a>前言</h2><p>在前面的小节中，我们一起学习了 if 标签，在通过 if 判断动态插入或查询的时候容易产生多余的前缀（如 WHERE）或后缀（如 , ），为了解决这类问题 MyBatis 提供了 where、set、trim 三个实用的标签。</p>
<p>其中 where 和 set 标签都是 trim 标签的一种特殊情况，不过使用频率非常高，因此被单独定义成了标签。本小节我们将一起来学习它们。</p>
<h2 id="定义-9"><a href="#定义-9" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p><code>where</code>、<code>set</code>、<code>trim</code> 三个标签都是为了解决 MyBatis 在动态生成 SQL 时，产生了多余的前缀和后缀的问题。</p>
</blockquote>
<h2 id="实例-8"><a href="#实例-8" class="headerlink" title="实例"></a>实例</h2><h3 id="where-实例"><a href="#where-实例" class="headerlink" title="where 实例"></a>where 实例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByIdAndName&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span></span><br><span class="line">      id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">      AND username = #&#123;username&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，id 和 username 均非固定的过滤参数，只有当其不为 null 时才会加入到 SQL 语句中。此处 where 标签的作用大概有如下 3 个：</p>
<ol>
<li>在 id 和 username 都为空的情况下，where 标签不会产生任何 SQL 代码段，最后的 SQL 语句为：<code>SELECT * FROM imooc_user</code>；</li>
<li>在 id 不为空，username 为空的情况下，或者在 id 不为空，username 也不为空的情况下，where 标签会自动给 SQL 代码段添加上 WHERE 前缀；</li>
<li>在 id 为空，username 不为空的情况下，where 标签会自定去除 AND 前缀，此时生成的 SQL 语句为： <code>SELECT * FROM imooc_user WHERE username = ?</code>。</li>
</ol>
<h3 id="set-实例"><a href="#set-实例" class="headerlink" title="set 实例"></a>set 实例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUsernameAndScoreById&quot;</span>&gt;</span></span><br><span class="line">  UPDATE imooc_user</span><br><span class="line">  <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">      username = #&#123;username&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    id = #&#123;id&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>set 标签会自动在 SQL 语句中添加上相应的 SET 前缀，并根据里面的条件动态地添加相应的字段。</p>
<p>由于 SQL update 的语法问题，若 set 标签里面条件均不满足，此时 set 标签也不会添加上 SET 前缀，但此时 SQL 会报语法错误，所以 set 标签中还是得有一个必然存在的赋值。</p>
<h3 id="trim-实例"><a href="#trim-实例" class="headerlink" title="trim 实例"></a>trim 实例</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUsernameAndScoreById&quot;</span>&gt;</span></span><br><span class="line">  UPDATE imooc_user</span><br><span class="line">  <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;SET&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">      username = #&#123;username&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span></span><br><span class="line">      id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">  WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里的 trim 实例实现了与 set 实例同样的功能，set 标签是 trim 标签的一种特殊情况。</p>
<p>trim 标签共有 4 个属性，它们的作用分别如下：</p>
<ul>
<li><strong>prefix：</strong> 前缀属性，若标签内不为空则在 SQL 中添加上前缀；</li>
<li><strong>prefixOverrides：</strong> 前缀覆盖属性，若标签中有多余的前缀，将会被覆盖（其实就是丢弃该前缀）；</li>
<li><strong>suffix：</strong> 后缀属性，若标签内不为空则在 SQL 中添加上后缀；</li>
<li><strong>suffixOverrides：</strong> 后缀覆盖属性，若标签中有多余的后缀，将会被覆盖（其实就是丢弃该后缀）。</li>
</ul>
<p>这个例子中，trim 标签的前缀为<code>SET</code>，后缀覆盖属性为<code>,</code>，所以在标签内不为空的情况下给 SQL 语句添加了 SET 关键字，且标签内若有多余的<code>,</code>后缀也会被丢弃。</p>
<h2 id="实践-8"><a href="#实践-8" class="headerlink" title="实践"></a>实践</h2><h3 id="例1-动态插入用户"><a href="#例1-动态插入用户" class="headerlink" title="例1. 动态插入用户"></a>例1. 动态插入用户</h3><p>请使用 MyBatis 完成对 imooc_user 表动态插入用户的功能，若用户属性值不为 null 则插入该字段，否则不插入字段。</p>
<p><strong>分析：</strong></p>
<p>按照 MyBatis 的开发模式，先在 UserMapper.xml 文件中添加动态插入用户的 insert 标签，然后在 UserMapper.java 中添加上对应的方法。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加 insert 标签，并在标签中写入 SQL，使用 trim 标签来动态判断属性是否为空，若不为空则插入该字段。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUserDynamic&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  INSERT INTO imooc_user</span><br><span class="line">  <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">      username,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span></span><br><span class="line">      age,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;score != null&quot;</span>&gt;</span></span><br><span class="line">      score,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">  VALUES</span><br><span class="line">  <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">      #&#123;username&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span></span><br><span class="line">      #&#123;age&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;score != null&quot;</span>&gt;</span></span><br><span class="line">      #&#123;score&#125;,</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里，我们使用了两个 trim 标签，一个用来动态写入字段名，另一个用来动态写入字段值；trim 标签的前缀为<code>(</code>,后缀为<code>)</code>，当出现多余的<code>,</code>时，会通过后缀覆盖属性来丢弃。</p>
<p>然后在 UserMapper.java 中添加上对应的接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">insertUserDynamic</span><span class="params">(User user)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 insertUserDynamic 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setUsername(<span class="string">&quot;dynamic&quot;</span>);</span><br><span class="line">user.setScore(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">int</span> rows = userMapper.insertUserDynamic(user);</span><br><span class="line">System.out.println(rows);</span><br></pre></td></tr></table></figure>

<p>成功后，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>TIPS:</strong> 注意，在 username、score 和 age 均为 null 时， insertUserDynamic 会报 SQL 语法错误，但理论上若是所有属性均为空，那么也不应该插入。</p>
</blockquote>
<h2 id="小结-11"><a href="#小结-11" class="headerlink" title="小结"></a>小结</h2><ul>
<li>where、set 以及 trim 将 MyBatis 的动态 SQL 发挥到了极致，为开发者节省了大量的精力和时间。</li>
<li>trim 标签是 MyBatis 中最为强大的一个标签，使用它可以方便的完成 SQL 动态插入和动态更新。</li>
</ul>
<h1 id="MyBatis-foreach"><a href="#MyBatis-foreach" class="headerlink" title="MyBatis foreach"></a>MyBatis foreach</h1><h2 id="前言-12"><a href="#前言-12" class="headerlink" title="前言"></a>前言</h2><p>在 MyBatis 中，常常会遇到集合类型的参数，虽然我们可以通过 OGNL 表达式来访问集合的某一个元素，但是 OGNL 表达式无法遍历集合。foreach 标签就是专门用来解决这类问题的，本小节我们就来一起学习它。</p>
<h2 id="定义-10"><a href="#定义-10" class="headerlink" title="定义"></a>定义</h2><blockquote>
<p><code>foreach</code> 标签用来遍历数组、列表和 Map 等集合参数，常与 in 关键字搭配使用。</p>
</blockquote>
<h2 id="实例-9"><a href="#实例-9" class="headerlink" title="实例"></a>实例</h2><p>我们以 3 个例子来看一看 foreach 是如何遍历列表、数组和 Map 的。</p>
<h3 id="遍历列表"><a href="#遍历列表" class="headerlink" title="遍历列表"></a>遍历列表</h3><p>xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserInIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  WHERE id IN</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">    #&#123;item&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;User&gt; <span class="title">selectUserInIds</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br></pre></td></tr></table></figure>

<p>上面是 selectUserInIds 方法在 java 和 xml 中对应的代码段。</p>
<p>foreach 标签共有 6 个属性，它们的作用分别为：</p>
<ul>
<li><strong>collection：</strong> 被遍历集合参数的名称，如 list；</li>
<li><strong>open：</strong> 遍历开始时插入到 SQL 中的字符串，如 ( ；</li>
<li><strong>close：</strong> 遍历结束时插入到 SQL 中的字符串，如 ) ；</li>
<li><strong>separator：</strong> 分割符，在每个元素的后面都会插入分割符；</li>
<li><strong>item：</strong> 元素值，遍历集合时元素的值；</li>
<li><strong>index：</strong> 元素序列，遍历集合时元素的序列。</li>
</ul>
<p>当 selectUserInIds 方法的参数 ids 为<code>Arrays.asList(1, 2)</code>时，生成的 SQL 语句为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM imooc_user WHERE id IN ( 1 , 2 ) </span><br></pre></td></tr></table></figure>

<p>foreach 标签的 collection 属性在接受参数名有两种情况：一、匿名参数，当在 java 方法中没有通过 @Param 注解指定参数名时，列表类型的使用默认参数名 list。二、具名参数，java 方法中使用了@Param 注解指定了参数名称，则 foreach 中的 collection 属性必须为参数名，如：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;User&gt; <span class="title">selectUserInIds</span><span class="params">(<span class="meta">@Param(&quot;ids&quot;)</span> List&lt;Integer&gt; ids)</span></span>;</span><br><span class="line"></span><br><span class="line">&lt;foreach collection=<span class="string">&quot;ids&quot;</span> open=<span class="string">&quot;(&quot;</span> close=<span class="string">&quot;)&quot;</span> separator=<span class="string">&quot;,&quot;</span> item=<span class="string">&quot;item&quot;</span> index=<span class="string">&quot;index&quot;</span>&gt;</span><br><span class="line">  #&#123;item&#125;</span><br><span class="line">&lt;/foreach&gt;</span><br></pre></td></tr></table></figure>

<p>我们推荐你为列表类型参数用注解指定一个名称，让使用该名称来遍历，方便代码维护和阅读。</p>
<h3 id="遍历数组"><a href="#遍历数组" class="headerlink" title="遍历数组"></a>遍历数组</h3><p>当 Java 方法使用的参数类型为数组时，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;User&gt; <span class="title">selectUserInIds</span><span class="params">(Integer[] ids)</span></span>;</span><br></pre></td></tr></table></figure>

<p>如果 ids 参数使用 @Param 注解指定了参数名称，则 foreach 标签中的 collection 属性必须为该名称；但若未指定名称，则在 foreach 标签中使用默认数组名称 array，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserInIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  WHERE id IN</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;array&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">    #&#123;item&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="遍历-Map"><a href="#遍历-Map" class="headerlink" title="遍历 Map"></a>遍历 Map</h3><p>当 Java 方法使用的参数类型为 Map 时，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateUserById</span><span class="params">(<span class="meta">@Param(&quot;params&quot;)</span> Map map, <span class="meta">@Param(&quot;id&quot;)</span> Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>使用 foreach 标签遍历 Map 时，collection 属性值为注解指定的参数名，即 params，且 item 是 Map 的键值，index 是键名。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserById&quot;</span>&gt;</span></span><br><span class="line">  UPDATE imooc_user</span><br><span class="line">  SET</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;params&quot;</span> <span class="attr">item</span>=<span class="string">&quot;val&quot;</span> <span class="attr">index</span>=<span class="string">&quot;key&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">    $&#123;key&#125; = #&#123;val&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">  WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 由于 key 是字段名称，因此不能使用<code>#&#123;&#125;</code>作为占位符，只能使用<code>$&#123;&#125;</code>在字符串中替换。</p>
<p>updateUserById 生成的 SQL 语句大致如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE imooc_user <span class="keyword">SET</span> score <span class="operator">=</span> ? , age <span class="operator">=</span> ? <span class="keyword">WHERE</span> id <span class="operator">=</span> ? </span><br></pre></td></tr></table></figure>



<h2 id="实践-9"><a href="#实践-9" class="headerlink" title="实践"></a>实践</h2><h3 id="例1-使用名称批量查询用户"><a href="#例1-使用名称批量查询用户" class="headerlink" title="例1. 使用名称批量查询用户"></a>例1. 使用名称批量查询用户</h3><p>请使用 MyBatis 完成对 imooc_user 表使用名称批量查询用户的功能，参数为一个名称列表，使用 in 关键字进行查询。</p>
<p><strong>分析：</strong></p>
<p>按照 MyBatis 的开发模式，先在 UserMapper.xml 文件中添加使用名称批量查询用户的 select 标签，然后在 UserMapper.java 中添加上对应的方法。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加 select 标签，并在标签中写入 SQL，使用 foreach 标签来遍历名称列表。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserInNames&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.ahao.mybatis.model.User&quot;</span>&gt;</span></span><br><span class="line">  SELECT * FROM imooc_user</span><br><span class="line">  WHERE username IN</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;names&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span>&gt;</span></span><br><span class="line">    #&#123;item&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后在 UserMapper.java 中添加上对应的接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function">List&lt;User&gt; <span class="title">selectUserInNames</span><span class="params">(<span class="meta">@Param(&quot;names&quot;)</span> List&lt;String&gt; names)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 selectUserInNames 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">List&lt;User&gt; users = userMapper.selectUserInNames(Arrays.asList(<span class="string">&quot;pedro&quot;</span>, <span class="string">&quot;peter&quot;</span>));</span><br><span class="line">System.out.println(users);</span><br></pre></td></tr></table></figure>

<p>成功后，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[User&#123;id=1, username=<span class="string">&#x27;peter&#x27;</span>, age=18, score=100&#125;, User&#123;id=2, username=<span class="string">&#x27;pedro&#x27;</span>, age=24, score=200&#125;]</span><br></pre></td></tr></table></figure>



<h3 id="例2-批量插入用户"><a href="#例2-批量插入用户" class="headerlink" title="例2. 批量插入用户"></a>例2. 批量插入用户</h3><p>请使用 MyBatis 完成对 imooc_user 表批量插入用户的功能，参数为一个用户列表。</p>
<p><strong>分析：</strong></p>
<p>同上。</p>
<p><strong>步骤：</strong></p>
<p>首先，在 UserMapper.xml 中添加 insert 标签，并在标签中写入 SQL，使用 foreach 标签来遍历用户列表。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUsers&quot;</span>&gt;</span></span><br><span class="line">  INSERT INTO imooc_user(username,age,score)</span><br><span class="line">  VALUES</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;users&quot;</span> <span class="attr">item</span>=<span class="string">&quot;user&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">    (#&#123;user.username&#125;, #&#123;user.age&#125;, #&#123;user.score&#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意，这里遍历 users 得到的单位是 user，user 是一个对象，因此必须通过 OGNL 表达式来取 user 的属性。</p>
<p>然后在 UserMapper.java 中添加上对应的接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">insertUsers</span><span class="params">(<span class="meta">@Param(&quot;users&quot;)</span> List&lt;User&gt; users)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 insertUsers 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">User user1 = <span class="keyword">new</span> User();</span><br><span class="line">user1.setUsername(<span class="string">&quot;user1&quot;</span>);</span><br><span class="line">user1.setScore(<span class="number">100</span>);</span><br><span class="line">user1.setAge(<span class="number">0</span>);</span><br><span class="line">User user2 = <span class="keyword">new</span> User();</span><br><span class="line">user2.setUsername(<span class="string">&quot;user2&quot;</span>);</span><br><span class="line">user2.setScore(<span class="number">210</span>);</span><br><span class="line">user2.setAge(<span class="number">20</span>);</span><br><span class="line"><span class="keyword">int</span> rows = userMapper.insertUsers(Arrays.asList(user1, user2));</span><br><span class="line">System.out.println(rows);</span><br></pre></td></tr></table></figure>

<p>成功后，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2</span><br></pre></td></tr></table></figure>



<h2 id="小结-12"><a href="#小结-12" class="headerlink" title="小结"></a>小结</h2><ul>
<li>foreach 标签是使用非常广泛的一个标签，当使用 SQL 进行批量插入、查询时都需要使用到它。</li>
<li>列表遍历的使用最为广泛，数组和 Map 则相对较少。</li>
</ul>
<h1 id="MyBatis-script"><a href="#MyBatis-script" class="headerlink" title="MyBatis script"></a>MyBatis script</h1><h2 id="前言-13"><a href="#前言-13" class="headerlink" title="前言"></a>前言</h2><p>前面一系列动态 SQL 小节的学习中，我们都是在 xml 中书写 SQL 的。注解无法发挥 MyBatis 动态 SQL 的真正威力，但是 if、choose、bind、where 等标签还是可以在注解中使用的。</p>
<p>MyBatis 官方文档对于此的介绍只有寥寥一句话和一个简单的例子，在实际的应用中也几乎没有人这样去做，因为它确实不太美观，但是考虑到这个知识点并不复杂，也极有可能成为一个刁钻的面试点，我们还是一起来学习一下。</p>
<h2 id="实例-10"><a href="#实例-10" class="headerlink" title="实例"></a>实例</h2><p>在注解中使用动态 SQL 其实十分简单，只需在动态 SQL 语句的外面包上一层<code>script</code>标签即可。如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&#123;&quot;&lt;script&gt;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;SELECT * FROM imooc_user&quot;,</span></span><br><span class="line"><span class="meta">   &quot;    WHERE&quot;,</span></span><br><span class="line"><span class="meta">   &quot;    &lt;choose&gt;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;      &lt;when test=&#x27;id != null&#x27;&gt;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;        id = #&#123;id&#125;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;      &lt;/when&gt;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;      &lt;when test=&#x27;username != null&#x27;&gt;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;        username = #&#123;username&#125;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;      &lt;/when&gt;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;      &lt;otherwise&gt;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;        1 = 0&quot;,</span></span><br><span class="line"><span class="meta">   &quot;      &lt;/otherwise&gt;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;    &lt;/choose&gt;&quot;,</span></span><br><span class="line"><span class="meta">   &quot;&lt;/script&gt;&quot;&#125;)</span></span><br><span class="line"><span class="function">User <span class="title">selectUserByIdOrName</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id, <span class="meta">@Param(&quot;username&quot;)</span> String username)</span></span>;</span><br></pre></td></tr></table></figure>

<p>在 Select 注解中，我们没有直接写入 SQL，而是在最外层套上一个 script 标签，这里考虑到 SQL 语句的美观性，我们把语句分成了字符串数组来书写，MyBatis 会自动将其拼接成一个完整的语句。</p>
<h2 id="实践-10"><a href="#实践-10" class="headerlink" title="实践"></a>实践</h2><h3 id="例1-查询小写名称客户"><a href="#例1-查询小写名称客户" class="headerlink" title="例1. 查询小写名称客户"></a>例1. 查询小写名称客户</h3><p>请使用 MyBatis 完成对 imooc_user 表查询小写名称客户的功能，将名称小写后再进行查询。</p>
<p><strong>分析：</strong></p>
<p>使用本小节所学的知识，直接在 UserMapper.java 接口上添加方法，并使用 Select 注解即可。</p>
<p><strong>步骤：</strong></p>
<p>在 UserMapper.java 中添加上对应的接口方法，方法接受 username 一个参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ahao.mybatis.mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> com.ahao.mybatis.model.User;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Select(&#123;</span></span><br><span class="line"><span class="meta">    &quot;&lt;script&gt;&quot;,</span></span><br><span class="line"><span class="meta">    &quot;&lt;bind name=\&quot;lowercaseName\&quot; value=\&quot;username.toLowercase\&quot;/&gt;&quot;,</span></span><br><span class="line"><span class="meta">    &quot;SELECT * FROM imooc_user&quot;,</span></span><br><span class="line"><span class="meta">    &quot;WHERE username = #&#123;lowercaseName&#125;&quot;,</span></span><br><span class="line"><span class="meta">    &quot;&lt;/script&gt;&quot;</span></span><br><span class="line"><span class="meta">  &#125;)</span></span><br><span class="line">  <span class="function">User <span class="title">selectUsernameLowercase</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>结果：</strong></p>
<p>通过如下代码，我们运行 selectUsernameLowercase 这个方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserMapper userMapper = session.getMapper(UserMapper.class);</span><br><span class="line">User pedro = userMapper.selectUsernameLowercase(<span class="string">&quot;PEDRO&quot;</span>);</span><br><span class="line">System.out.println(pedro);</span><br></pre></td></tr></table></figure>

<p>成功后，结果为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User&#123;id=2, username=<span class="string">&#x27;pedro&#x27;</span>, age=24, score=200&#125;</span><br></pre></td></tr></table></figure>



<h2 id="小结-13"><a href="#小结-13" class="headerlink" title="小结"></a>小结</h2><ul>
<li>通过 scirpt 标签，我们可以在注解中使用动态 SQL 的诸多标签，极大地增强了注解的能力，但相对于 xml 这种更为优雅的方式，无疑是后者更佳，因此我们我们强力推荐你使用 xml 的方式。</li>
</ul>
<h1 id="MyBatis-配置介绍"><a href="#MyBatis-配置介绍" class="headerlink" title="MyBatis 配置介绍"></a>MyBatis 配置介绍</h1><h2 id="前言-14"><a href="#前言-14" class="headerlink" title="前言"></a>前言</h2><p>MyBatis 的配置十分重要，它直接左右 MyBatis 的行为。我们可以将 MyBatis 配置分为<code>两大部分</code>，第一部分是 mapper，也就是容纳 SQL 语句的.xml文件，另一部分是 configuration ，也就是前面小节提到的 mybatis-config.xml 文件。</p>
<p>本小节，我们将介绍 configuration 中常见且有用的配置项。</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><p>MyBatis 以 .xml 作为配置文件，且以 configuration 作为配置的根节点。在 configuration 下有诸多配置项，它们的结构如下：</p>
<p>configuration（配置）</p>
<ul>
<li>properties（属性）</li>
<li>settings（设置）</li>
<li>typeAliases（类型别名）</li>
<li>typeHandlers（类型处理器）</li>
<li>objectFactory（对象工厂）</li>
<li>plugins（插件）</li>
<li>environments（环境配置）<ul>
<li>environment（环境变量）<ul>
<li>transactionManager（事务管理器）</li>
<li>dataSource（数据源）</li>
</ul>
</li>
</ul>
</li>
<li>databaseIdProvider（数据库厂商标识）</li>
<li>mappers（映射器）</li>
</ul>
<p>MyBatis configuration 共 9 项，其中一些配置在前面的小节中已经介绍到了，下面我们将分别介绍每一项配置。</p>
<h2 id="属性-properties"><a href="#属性-properties" class="headerlink" title="属性 properties"></a>属性 properties</h2><p>通过 properties 配置，我们可以将一些重要的配置属性<code>抽离</code>到其它的 .properties 文件。</p>
<p>比如，dataSource 中的数据库 url、用户名和密码，我们可以单独以 datasource.properties 文件来存储，然后在 mybatis-config.xml 文件中导入使用。</p>
<p>在 resources 目录下新建 datasource.properties 文件，并填入以下内容：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://localhost:3306/imooc?useSSL=false</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>

<p>然后在 mybatis-config.xml 文件中通过 properties 配置来引入 datasource.properties 文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  引入datasource.properties  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;datasource.properties&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--  占位符动态替换配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过 properties 中的 resource 属性引入 datasource.properties 后，我们就可以使用占位符的方式去动态替换配置，如 <code>$&#123;url&#125;</code>，表示从 datasource.properties 文件中取出 url 项并填充在此处。</p>
<p>它们在目录中的位置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src&#x2F;main&#x2F;resources</span><br><span class="line">├── datasource.properties</span><br><span class="line">├── mybatis-config.xml</span><br></pre></td></tr></table></figure>



<h2 id="设置-settings"><a href="#设置-settings" class="headerlink" title="设置 settings"></a>设置 settings</h2><p>MyBatis 提供了 settings 来设置一些主要的参数，它们会直接的改变 MyBatis 的运行时行为。</p>
<p>settings 共有十几项，我们罗列一些常用的：</p>
<table>
<thead>
<tr>
<th align="left">设置名</th>
<th align="left">描述</th>
<th align="left">可选值</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">cacheEnabled</td>
<td align="left">全局地开启或关闭所有 mapper 中的缓存</td>
<td align="left">true | false</td>
<td align="left">true</td>
</tr>
<tr>
<td align="left">lazyLoadingEnabled</td>
<td align="left">延迟加载的全局开关，当开启时，所有关联对象都会延迟加载</td>
<td align="left">true | false</td>
<td align="left">false</td>
</tr>
<tr>
<td align="left">defaultStatementTimeout</td>
<td align="left">设置数据库查询超时时间</td>
<td align="left">任意正整数</td>
<td align="left">null</td>
</tr>
<tr>
<td align="left">mapUnderscoreToCamelCase</td>
<td align="left">是否开启自动驼峰命名规则（camel case）映射</td>
<td align="left">true ｜false</td>
<td align="left">false</td>
</tr>
<tr>
<td align="left">localCacheScope</td>
<td align="left">MyBatis会默认缓存会话中的查询，即 SESSION，若无需缓存则设置为 STATEMENT</td>
<td align="left">SESSION ｜ STATEMENT</td>
<td align="left">SESSION</td>
</tr>
<tr>
<td align="left">defaultEnumTypeHandler</td>
<td align="left">指定 Enum 使用的默认 TypeHandler</td>
<td align="left">Java 类的全路径</td>
<td align="left">org.apache.ibatis. type.EnumTypeHandler</td>
</tr>
<tr>
<td align="left">logPrefix</td>
<td align="left">指定 MyBatis 日志名称前缀</td>
<td align="left">任何字符串</td>
<td align="left">未设置</td>
</tr>
<tr>
<td align="left">logImpl</td>
<td align="left">指定 MyBatis 日志的实现，未指定时将自动查找</td>
<td align="left">SLF4J ｜ LOG4J｜LOG4J2｜JDK_LOGGING｜COMMONS_LOGGING｜STDOUT_LOGGING｜NO_LOGGING</td>
<td align="left">未设置</td>
</tr>
<tr>
<td align="left">proxyFactory</td>
<td align="left">指定 Mybatis 创建具有延迟加载能力的对象所用到的代理工具</td>
<td align="left">CGLIB ｜ JAVASSIST</td>
<td align="left">JAVASSIST</td>
</tr>
</tbody></table>
<p>当使用它们时，你只需要在 mybatis-config.xml 配置文件中打开相应的配置。</p>
<p>例如，我们开启了下划线转驼峰的配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="别名-typeAliases"><a href="#别名-typeAliases" class="headerlink" title="别名 typeAliases"></a>别名 typeAliases</h2><p>MyBatis 在指定 Java 类时需要使用到类的全路径，如 com.ahao.mybatis.model.Blog，typeAliases 可以为全路径定义一个别名，这样就能减少一定的重复工作。</p>
<p>例如，将 com.ahao.mybatis.model.Blog 的别名定义为 Blog：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.ahao.mybatis.model.Blog&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;Blog&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MyBatis 还支持为一个包下所有类定义别名：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.ahao.mybatis.model&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样在 com.ahao.mybatis.model 包中的所有类都有了别名，每个类的别名都是其类的名称首字母小写，如 Author 类的别名为 author。</p>
<h2 id="类型处理器-typeHandlers"><a href="#类型处理器-typeHandlers" class="headerlink" title="类型处理器 typeHandlers"></a>类型处理器 typeHandlers</h2><p>类型处理器我们将在类型处理器小节中再详细介绍。</p>
<h2 id="对象工厂-objectFactory"><a href="#对象工厂-objectFactory" class="headerlink" title="对象工厂 objectFactory"></a>对象工厂 objectFactory</h2><p>MyBatis 每次创建结果对象的新实例时，它都会使用一个对象工厂（ObjectFactory）来完成。MyBatis 默认的对象工厂仅仅只是实例化目标类，我们可以自定义一个对象工厂类来覆盖默认的对象工厂。</p>
<p>配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">objectFactory</span> <span class="attr">type</span>=<span class="string">&quot;org.mybatis.example.ExampleObjectFactory&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>绝大多数情况下，这个操作都是极其危险的，改变了 MyBatis 默认的对象创建行为可能会带来一定的兼容错误，所以我们不做过多介绍，如果你确实需要它，可以查阅相关的资料。</p>
<h2 id="插件-plugins"><a href="#插件-plugins" class="headerlink" title="插件 plugins"></a>插件 plugins</h2><p>插件我们将在插件小节中再详细介绍。</p>
<h2 id="环境配置-environments"><a href="#环境配置-environments" class="headerlink" title="环境配置 environments"></a>环境配置 environments</h2><p>环境配置是最为复杂的一项配置，MyBatis 提供了多环境配置机制，例如：开发环境和生产环境上的数据库配置就大概率不一样。</p>
<p>每个 environment 都有一个唯一的 id 字段，且 environments 需要提供一个默认环境，如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">  <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/imooc?useSSL=false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在每个 environment 下又有两个子配置项，它们分别负责管理事务和数据源。</p>
<h3 id="事务管理器-transactionManager"><a href="#事务管理器-transactionManager" class="headerlink" title="事务管理器 transactionManager"></a>事务管理器 transactionManager</h3><p>在 xml 文件中对应 <code>&lt;transactionManager type=&quot;JDBC&quot;/&gt;</code>，其中 type 属性对应了事务管理器的两种类型，分别是JDBC和MANAGED。</p>
<ul>
<li>JDBC ：直接使用了 JDBC 的提交和回滚机制。</li>
<li>MANAGED：让容器来管理事务的整个生命周期，例如 spring 容器。</li>
</ul>
<blockquote>
<p><strong>提示：</strong> 如果你使用 spring 作为容器，那么 transactionManager 会被自动配置且可用。</p>
</blockquote>
<h3 id="数据源-dataSource"><a href="#数据源-dataSource" class="headerlink" title="数据源 dataSource"></a>数据源 dataSource</h3><p>在 xml 文件中对应<code>&lt;dataSource type=&quot;POOLED&quot;&gt;</code>，其中 type 属性代表了数据源的类型，可选的有三种类型，如下：</p>
<ul>
<li>UNPOOLED：非池化数据源，每次使用时打开，结束后关闭，不推荐。</li>
<li>POOLED：池化数据源，连接池管理连接，推荐。</li>
<li>JNDI：在 EJB 这类容器中使用，几乎不用。</li>
</ul>
<h2 id="数据库厂商标识-databaseIdProvider"><a href="#数据库厂商标识-databaseIdProvider" class="headerlink" title="数据库厂商标识 databaseIdProvider"></a>数据库厂商标识 databaseIdProvider</h2><p>多数据源支持我们将在多数据源支持小节中详细介绍。</p>
<h2 id="映射器-mappers"><a href="#映射器-mappers" class="headerlink" title="映射器 mappers"></a>映射器 mappers</h2><p>通过 mappers 配置，我们可以指定所对应 SQL 映射文件，这样 MyBatis 才能找到另一部分的 SQL 配置文件。</p>
<p>mappers 可以包含多个 mapper，mapper 的加载共有 <code>4</code> 种方式。</p>
<h3 id="相对类路径"><a href="#相对类路径" class="headerlink" title="相对类路径"></a>相对类路径</h3><p>通过 resource 属性指定 mapper .xml 文件所对应的类路径。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/imooc/mybatis/mapper/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="URL路径"><a href="#URL路径" class="headerlink" title="URL路径"></a>URL路径</h3><p>通过 url 属性指定 mapper .xml 文件所对应的文件路径。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">&quot;file:///mapper/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="类路径"><a href="#类路径" class="headerlink" title="类路径"></a>类路径</h3><p>通过 class 属性指定 mapper 类所对应的类路径。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.ahao.mybatis.mapper.UserMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="包路径"><a href="#包路径" class="headerlink" title="包路径"></a>包路径</h3><p>通过制定包路径，将包中的所有接口类自动扫描为 mapper。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.ahao.mybatis.mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="小结-14"><a href="#小结-14" class="headerlink" title="小结"></a>小结</h2><ul>
<li>MyBatis 的配置是比较多的，本小节列举了一些<code>常用且重要</code>的配置，如果你还不满足，可以阅读这里的官方<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#properties">配置文档</a>。</li>
<li>MyBatis 的另一部分 SQL 配置虽然分散在了包中，但通过 mappers 这个中间桥梁，二者又紧密的结合在一起了。</li>
<li>在真实的开发中，会有专门的类库来提供这些配置，但你需要了解它们，以便在需要时迅速作出反应。</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">ahao</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://ahao.ink/posts/MyBatis%20%E5%88%9D%E7%BA%A7%E7%AF%87/">https://ahao.ink/posts/MyBatis%20%E5%88%9D%E7%BA%A7%E7%AF%87/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ahao.ink" target="_blank">ahao</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2021/12/26/LKQbkw4Bgr3ZjfX.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://i.loli.net/2021/11/12/6zSDdqXlvjMakgC.jpg" target="_blank"><img class="post-qr-code-img" src="https://i.loli.net/2021/11/12/6zSDdqXlvjMakgC.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://i.loli.net/2021/11/12/Xa5GvktA3qi7VYN.jpg" target="_blank"><img class="post-qr-code-img" src="https://i.loli.net/2021/11/12/Xa5GvktA3qi7VYN.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/MyBatis%20%E9%AB%98%E7%BA%A7%E7%AF%87/"><img class="prev-cover" src="https://s2.loli.net/2021/12/26/ECjF4hyGQelMUKr.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MyBatis 高级篇</div></div></a></div><div class="next-post pull-right"><a href="/posts/JVM/"><img class="next-cover" src="https://s2.loli.net/2021/12/26/vrNE75inPJ6RWs8.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JVM 底层原理知识总结</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://i.loli.net/2021/11/12/Edhsr56wxfUbuFg.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">ahao</div><div class="author-info__description">如有一味绝境，非历十方生死</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">48</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" href="https://ahao.ink"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">好 记 性 不 如 烂 笔 头</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.</span> <span class="toc-text">MyBatis 实验环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.2.</span> <span class="toc-text">新建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-number">1.3.</span> <span class="toc-text">添加依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="toc-number">1.4.</span> <span class="toc-text">数据准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.5.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">MyBatis 简单使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-1"><span class="toc-number">2.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E5%BC%8F%E4%BD%BF%E7%94%A8"><span class="toc-number">2.2.</span> <span class="toc-text">编程式使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8-MyBatis"><span class="toc-number">2.2.1.</span> <span class="toc-text">启动 MyBatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.2.</span> <span class="toc-text">使用流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%BC%8F%E4%BD%BF%E7%94%A8"><span class="toc-number">2.3.</span> <span class="toc-text">配置式使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.3.1.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8-MyBatis-1"><span class="toc-number">2.3.2.</span> <span class="toc-text">启动 MyBatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B-1"><span class="toc-number">2.3.3.</span> <span class="toc-text">使用流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-1"><span class="toc-number">2.4.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-mapper"><span class="toc-number">3.</span> <span class="toc-text">MyBatis mapper</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-2"><span class="toc-number">3.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89"><span class="toc-number">3.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA-mapper"><span class="toc-number">3.3.</span> <span class="toc-text">新建 mapper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.1.</span> <span class="toc-text">注解方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML-%E6%96%B9%E5%BC%8F"><span class="toc-number">3.3.2.</span> <span class="toc-text">XML 方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-mapper"><span class="toc-number">3.4.</span> <span class="toc-text">使用 mapper</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mapper-%E9%85%8D%E7%BD%AE"><span class="toc-number">3.4.1.</span> <span class="toc-text">mapper 配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%B0%83%E7%94%A8"><span class="toc-number">3.4.2.</span> <span class="toc-text">代码调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.4.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-2"><span class="toc-number">3.5.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-select"><span class="toc-number">4.</span> <span class="toc-text">MyBatis select</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-3"><span class="toc-number">4.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-1"><span class="toc-number">4.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.3.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xml-%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.3.1.</span> <span class="toc-text">xml 实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E7%AC%A6%E5%8F%B7"><span class="toc-number">4.3.2.</span> <span class="toc-text">参数符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AE%9E%E4%BE%8B"><span class="toc-number">4.3.3.</span> <span class="toc-text">注解实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#select-%E5%B1%9E%E6%80%A7"><span class="toc-number">4.4.</span> <span class="toc-text">select 属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">4.5.</span> <span class="toc-text">参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%8F%82%E6%95%B0"><span class="toc-number">4.5.1.</span> <span class="toc-text">对象参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="toc-number">4.5.2.</span> <span class="toc-text">参数配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5"><span class="toc-number">4.6.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1-%E9%80%9A%E8%BF%87%E5%B9%B4%E9%BE%84%E5%92%8C%E5%88%86%E6%95%B0%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7"><span class="toc-number">4.6.1.</span> <span class="toc-text">例1. 通过年龄和分数查询用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-3"><span class="toc-number">4.7.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-resultMap-%E4%B8%8E-sql"><span class="toc-number">5.</span> <span class="toc-text">MyBatis resultMap 与 sql</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-4"><span class="toc-number">5.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-2"><span class="toc-number">5.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-1"><span class="toc-number">5.3.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#resultMap-%E5%AE%9E%E4%BE%8B"><span class="toc-number">5.3.1.</span> <span class="toc-text">resultMap 实例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xml-%E5%AE%9E%E4%BE%8B-1"><span class="toc-number">5.3.1.1.</span> <span class="toc-text">xml 实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AE%9E%E4%BE%8B-1"><span class="toc-number">5.3.1.2.</span> <span class="toc-text">注解实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQL-%E5%AE%9E%E4%BE%8B"><span class="toc-number">5.3.2.</span> <span class="toc-text">SQL 实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-1"><span class="toc-number">5.4.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1-%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7%E5%A7%93%E5%90%8D%E5%92%8C%E5%B9%B4%E9%BE%84"><span class="toc-number">5.4.1.</span> <span class="toc-text">例1. 查询用户姓名和年龄</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-4"><span class="toc-number">5.5.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-insert"><span class="toc-number">6.</span> <span class="toc-text">MyBatis insert</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-5"><span class="toc-number">6.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-3"><span class="toc-number">6.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-2"><span class="toc-number">6.3.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xml-%E5%AE%9E%E4%BE%8B-2"><span class="toc-number">6.3.1.</span> <span class="toc-text">xml 实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AE%9E%E4%BE%8B-2"><span class="toc-number">6.3.2.</span> <span class="toc-text">注解实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#insert-%E5%B1%9E%E6%80%A7"><span class="toc-number">6.4.</span> <span class="toc-text">insert 属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E4%B8%BB%E9%94%AE"><span class="toc-number">6.5.</span> <span class="toc-text">返回主键</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%A2%9E%E4%B8%BB%E9%94%AE"><span class="toc-number">6.5.1.</span> <span class="toc-text">自增主键</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xml-%E6%96%B9%E5%BC%8F"><span class="toc-number">6.5.1.1.</span> <span class="toc-text">xml 方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F-1"><span class="toc-number">6.5.1.2.</span> <span class="toc-text">注解方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#selectKey-%E6%A0%87%E7%AD%BE"><span class="toc-number">6.5.2.</span> <span class="toc-text">selectKey 标签</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#xml-%E6%96%B9%E5%BC%8F-1"><span class="toc-number">6.5.2.1.</span> <span class="toc-text">xml 方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E6%96%B9%E5%BC%8F-2"><span class="toc-number">6.5.2.2.</span> <span class="toc-text">注解方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-2"><span class="toc-number">6.6.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1-%E6%8F%92%E5%85%A5%E7%94%A8%E6%88%B7"><span class="toc-number">6.6.1.</span> <span class="toc-text">例1. 插入用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-5"><span class="toc-number">6.7.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-update"><span class="toc-number">7.</span> <span class="toc-text">MyBatis update</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-6"><span class="toc-number">7.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-4"><span class="toc-number">7.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-3"><span class="toc-number">7.3.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xml-%E5%AE%9E%E4%BE%8B-3"><span class="toc-number">7.3.1.</span> <span class="toc-text">xml 实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AE%9E%E4%BE%8B-3"><span class="toc-number">7.3.2.</span> <span class="toc-text">注解实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update-%E5%B1%9E%E6%80%A7"><span class="toc-number">7.4.</span> <span class="toc-text">update 属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-3"><span class="toc-number">7.5.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1-%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E5%B9%B4%E9%BE%84"><span class="toc-number">7.5.1.</span> <span class="toc-text">例1. 更新用户年龄</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B2-%E6%9B%B4%E6%96%B0%E7%94%A8%E6%88%B7%E5%90%8D%E7%A7%B0%E5%92%8C%E5%88%86%E6%95%B0"><span class="toc-number">7.5.2.</span> <span class="toc-text">例2. 更新用户名称和分数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-6"><span class="toc-number">7.6.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-delete"><span class="toc-number">8.</span> <span class="toc-text">MyBatis delete</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-7"><span class="toc-number">8.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-5"><span class="toc-number">8.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-4"><span class="toc-number">8.3.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#xml-%E5%AE%9E%E4%BE%8B-4"><span class="toc-number">8.3.1.</span> <span class="toc-text">xml 实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AE%9E%E4%BE%8B-4"><span class="toc-number">8.3.2.</span> <span class="toc-text">注解实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delete-%E5%B1%9E%E6%80%A7"><span class="toc-number">8.4.</span> <span class="toc-text">delete 属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-4"><span class="toc-number">8.5.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1-%E6%A0%B9%E6%8D%AE-id-%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-number">8.5.1.</span> <span class="toc-text">例1. 根据 id 删除用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B2-%E6%A0%B9%E6%8D%AE%E7%94%A8%E6%88%B7%E5%90%8D%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7"><span class="toc-number">8.5.2.</span> <span class="toc-text">例2. 根据用户名删除用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-7"><span class="toc-number">8.6.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OGNL-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">9.</span> <span class="toc-text">OGNL 表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-8"><span class="toc-number">9.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-6"><span class="toc-number">9.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">9.3.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-5"><span class="toc-number">9.3.1.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84-OGNL-%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">9.3.2.</span> <span class="toc-text">常见的 OGNL 表达式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-5"><span class="toc-number">9.4.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">9.4.1.</span> <span class="toc-text">访问属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%88%97%E8%A1%A8"><span class="toc-number">9.4.2.</span> <span class="toc-text">访问列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AF%94%E8%BE%83"><span class="toc-number">9.4.3.</span> <span class="toc-text">比较</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97"><span class="toc-number">9.4.4.</span> <span class="toc-text">运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-number">9.4.5.</span> <span class="toc-text">方法调用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-8"><span class="toc-number">9.5.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-if-%E5%92%8C%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81"><span class="toc-number">10.</span> <span class="toc-text">MyBatis if 和多数据库支持</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-9"><span class="toc-number">10.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-7"><span class="toc-number">10.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-6"><span class="toc-number">10.3.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-6"><span class="toc-number">10.4.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1%E3%80%81%E5%8A%A8%E6%80%81%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7"><span class="toc-number">10.4.1.</span> <span class="toc-text">例1、动态查询用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%94%AF%E6%8C%81"><span class="toc-number">10.5.</span> <span class="toc-text">多数据库支持</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">10.5.1.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">10.5.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-9"><span class="toc-number">10.6.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-choose-%E5%92%8C-bind"><span class="toc-number">11.</span> <span class="toc-text">MyBatis choose 和 bind</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-10"><span class="toc-number">11.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-8"><span class="toc-number">11.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-7"><span class="toc-number">11.3.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-7"><span class="toc-number">11.4.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1-%E5%A4%9A%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7"><span class="toc-number">11.4.1.</span> <span class="toc-text">例1. 多条件查询用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B2-%E6%9F%A5%E8%AF%A2%E5%B0%8F%E5%86%99%E5%90%8D%E7%A7%B0%E5%AE%A2%E6%88%B7"><span class="toc-number">11.4.2.</span> <span class="toc-text">例2. 查询小写名称客户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-10"><span class="toc-number">11.5.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-where%E3%80%81set%E3%80%81trim"><span class="toc-number">12.</span> <span class="toc-text">MyBatis where、set、trim</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-11"><span class="toc-number">12.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-9"><span class="toc-number">12.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-8"><span class="toc-number">12.3.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#where-%E5%AE%9E%E4%BE%8B"><span class="toc-number">12.3.1.</span> <span class="toc-text">where 实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set-%E5%AE%9E%E4%BE%8B"><span class="toc-number">12.3.2.</span> <span class="toc-text">set 实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#trim-%E5%AE%9E%E4%BE%8B"><span class="toc-number">12.3.3.</span> <span class="toc-text">trim 实例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-8"><span class="toc-number">12.4.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1-%E5%8A%A8%E6%80%81%E6%8F%92%E5%85%A5%E7%94%A8%E6%88%B7"><span class="toc-number">12.4.1.</span> <span class="toc-text">例1. 动态插入用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-11"><span class="toc-number">12.5.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-foreach"><span class="toc-number">13.</span> <span class="toc-text">MyBatis foreach</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-12"><span class="toc-number">13.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-10"><span class="toc-number">13.2.</span> <span class="toc-text">定义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-9"><span class="toc-number">13.3.</span> <span class="toc-text">实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%8D%E5%8E%86%E5%88%97%E8%A1%A8"><span class="toc-number">13.3.1.</span> <span class="toc-text">遍历列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%8D%E5%8E%86%E6%95%B0%E7%BB%84"><span class="toc-number">13.3.2.</span> <span class="toc-text">遍历数组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%81%8D%E5%8E%86-Map"><span class="toc-number">13.3.3.</span> <span class="toc-text">遍历 Map</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-9"><span class="toc-number">13.4.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1-%E4%BD%BF%E7%94%A8%E5%90%8D%E7%A7%B0%E6%89%B9%E9%87%8F%E6%9F%A5%E8%AF%A2%E7%94%A8%E6%88%B7"><span class="toc-number">13.4.1.</span> <span class="toc-text">例1. 使用名称批量查询用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B2-%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5%E7%94%A8%E6%88%B7"><span class="toc-number">13.4.2.</span> <span class="toc-text">例2. 批量插入用户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-12"><span class="toc-number">13.5.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-script"><span class="toc-number">14.</span> <span class="toc-text">MyBatis script</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-13"><span class="toc-number">14.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B-10"><span class="toc-number">14.2.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5-10"><span class="toc-number">14.3.</span> <span class="toc-text">实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B1-%E6%9F%A5%E8%AF%A2%E5%B0%8F%E5%86%99%E5%90%8D%E7%A7%B0%E5%AE%A2%E6%88%B7"><span class="toc-number">14.3.1.</span> <span class="toc-text">例1. 查询小写名称客户</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-13"><span class="toc-number">14.4.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D"><span class="toc-number">15.</span> <span class="toc-text">MyBatis 配置介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80-14"><span class="toc-number">15.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84"><span class="toc-number">15.2.</span> <span class="toc-text">结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7-properties"><span class="toc-number">15.3.</span> <span class="toc-text">属性 properties</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-settings"><span class="toc-number">15.4.</span> <span class="toc-text">设置 settings</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%AB%E5%90%8D-typeAliases"><span class="toc-number">15.5.</span> <span class="toc-text">别名 typeAliases</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8-typeHandlers"><span class="toc-number">15.6.</span> <span class="toc-text">类型处理器 typeHandlers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%B7%A5%E5%8E%82-objectFactory"><span class="toc-number">15.7.</span> <span class="toc-text">对象工厂 objectFactory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6-plugins"><span class="toc-number">15.8.</span> <span class="toc-text">插件 plugins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE-environments"><span class="toc-number">15.9.</span> <span class="toc-text">环境配置 environments</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E5%99%A8-transactionManager"><span class="toc-number">15.9.1.</span> <span class="toc-text">事务管理器 transactionManager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%BA%90-dataSource"><span class="toc-number">15.9.2.</span> <span class="toc-text">数据源 dataSource</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%82%E5%95%86%E6%A0%87%E8%AF%86-databaseIdProvider"><span class="toc-number">15.10.</span> <span class="toc-text">数据库厂商标识 databaseIdProvider</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%99%A8-mappers"><span class="toc-number">15.11.</span> <span class="toc-text">映射器 mappers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%AF%B9%E7%B1%BB%E8%B7%AF%E5%BE%84"><span class="toc-number">15.11.1.</span> <span class="toc-text">相对类路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URL%E8%B7%AF%E5%BE%84"><span class="toc-number">15.11.2.</span> <span class="toc-text">URL路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B1%BB%E8%B7%AF%E5%BE%84"><span class="toc-number">15.11.3.</span> <span class="toc-text">类路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E8%B7%AF%E5%BE%84"><span class="toc-number">15.11.4.</span> <span class="toc-text">包路径</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-14"><span class="toc-number">15.12.</span> <span class="toc-text">小结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/EventLoop%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/" title="EventLoop和线程模型"><img src="https://s2.loli.net/2021/12/24/oU8bJKuwTrD4pN3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="EventLoop和线程模型"/></a><div class="content"><a class="title" href="/posts/EventLoop%E5%92%8C%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B/" title="EventLoop和线程模型">EventLoop和线程模型</a><time datetime="2021-10-06T05:36:41.000Z" title="发表于 2021-10-06 13:36:41">2021-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/Netty%20%E5%BF%83%E8%B7%B3%E6%A3%80%E6%B5%8B/" title="Netty 心跳检测"><img src="https://s2.loli.net/2021/12/24/gYjCcwFdvQypA4b.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 心跳检测"/></a><div class="content"><a class="title" href="/posts/Netty%20%E5%BF%83%E8%B7%B3%E6%A3%80%E6%B5%8B/" title="Netty 心跳检测">Netty 心跳检测</a><time datetime="2021-09-30T05:36:41.000Z" title="发表于 2021-09-30 13:36:41">2021-09-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="序列化和反序列化到底有什么用呢？"><img src="https://s2.loli.net/2021/12/24/V7zmByD8F6fj3As.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="序列化和反序列化到底有什么用呢？"/></a><div class="content"><a class="title" href="/posts/%E5%BA%8F%E5%88%97%E5%8C%96%E4%B8%8E%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="序列化和反序列化到底有什么用呢？">序列化和反序列化到底有什么用呢？</a><time datetime="2021-09-30T05:36:41.000Z" title="发表于 2021-09-30 13:36:41">2021-09-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98/" title="Netty 数据缓存"><img src="https://s2.loli.net/2021/12/24/V7zmByD8F6fj3As.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Netty 数据缓存"/></a><div class="content"><a class="title" href="/posts/%E6%95%B0%E6%8D%AE%E7%BC%93%E5%AD%98/" title="Netty 数据缓存">Netty 数据缓存</a><time datetime="2021-09-30T05:36:41.000Z" title="发表于 2021-09-30 13:36:41">2021-09-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/ChannelHandler%20%E5%92%8C%20ChannelPipeline/" title="ChannelHandler 和 ChannelPipeline"><img src="https://s2.loli.net/2021/12/24/DJ4coNMTRzG3xFj.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ChannelHandler 和 ChannelPipeline"/></a><div class="content"><a class="title" href="/posts/ChannelHandler%20%E5%92%8C%20ChannelPipeline/" title="ChannelHandler 和 ChannelPipeline">ChannelHandler 和 ChannelPipeline</a><time datetime="2021-09-30T05:36:41.000Z" title="发表于 2021-09-30 13:36:41">2021-09-30</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://s2.loli.net/2021/12/26/LKQbkw4Bgr3ZjfX.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By ahao</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my <a href="https://ahao.ink" target="_self">blog</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'oKBwwKX9hp2tpOKDPE3PVQpL-gzGzoHsz',
      appKey: '3QBBKGzgsE11VOcVl1RElhgu',
      placeholder: '说点什么吧~',
      avatar: 'retro',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: true,
      serverURLs: '',
      emojiCDN: '//i0.hdslb.com/bfs/emote/',
      emojiMaps: {"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_親親":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再見":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_發怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_發財":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可愛":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_嘔吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_壞笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尷尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_驚嚇":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png"},
      enableQQ: true,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><div class="aplayer no-destroy" data-id="000PeZCQ1i4XVs" data-server="tencent" data-type="artist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="true" muted></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>